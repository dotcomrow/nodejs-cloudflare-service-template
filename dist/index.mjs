var e={176:(e,t,r)=>{r.r(t),r.d(t,{createFetchAdapter:()=>T,default:()=>O});var n=Object.create,i=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyDescriptors,c=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,u=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,p=(e,t,r)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,f=(e,t)=>{for(var r in t||={})d.call(t,r)&&p(e,r,t[r]);if(l)for(var r of l(t))h.call(t,r)&&p(e,r,t[r]);return e},y=(e,t)=>s(e,o(t)),m=(e,t)=>function(){return t||(0,e[c(e)[0]])((t={exports:{}}).exports,t),t.exports},g=(e,t,r)=>(r=null!=e?n(u(e)):{},((e,t,r,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of c(t))d.call(e,r)||undefined===r||i(e,r,{get:()=>t[r],enumerable:!(n=a(t,r))||n.enumerable});return e})(!t&&e&&e.__esModule?r:i(r,"default",{value:e,enumerable:!0}),e)),w=(e,t,r)=>new Promise(((n,i)=>{var s=e=>{try{o(r.next(e))}catch(e){i(e)}},a=e=>{try{o(r.throw(e))}catch(e){i(e)}},o=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,a);o((r=r.apply(e,t)).next())})),b=m({"node_modules/axios/lib/helpers/bind.js"(e,t){t.exports=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}}}),S=m({"node_modules/axios/lib/utils.js"(e,t){var r=b(),n=Object.prototype.toString;function i(e){return"[object Array]"===n.call(e)}function s(e){return void 0===e}function a(e){return null!==e&&"object"==typeof e}function o(e){if("[object Object]"!==n.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function c(e){return"[object Function]"===n.call(e)}function l(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),i(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.call(null,e[s],s,e)}t.exports={isArray:i,isArrayBuffer:function(e){return"[object ArrayBuffer]"===n.call(e)},isBuffer:function(e){return null!==e&&!s(e)&&null!==e.constructor&&!s(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:a,isPlainObject:o,isUndefined:s,isDate:function(e){return"[object Date]"===n.call(e)},isFile:function(e){return"[object File]"===n.call(e)},isBlob:function(e){return"[object Blob]"===n.call(e)},isFunction:c,isStream:function(e){return a(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:l,merge:function e(){var t={};function r(r,n){o(t[n])&&o(r)?t[n]=e(t[n],r):o(r)?t[n]=e({},r):i(r)?t[n]=r.slice():t[n]=r}for(var n=0,s=arguments.length;n<s;n++)l(arguments[n],r);return t},extend:function(e,t,n){return l(t,(function(t,i){e[i]=n&&"function"==typeof t?r(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}}}),E=m({"node_modules/axios/lib/helpers/buildURL.js"(e,t){var r=S();function n(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(e,t,i){if(!t)return e;var s;if(i)s=i(t);else if(r.isURLSearchParams(t))s=t.toString();else{var a=[];r.forEach(t,(function(e,t){null!=e&&(r.isArray(e)?t+="[]":e=[e],r.forEach(e,(function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),a.push(n(t)+"="+n(e))})))})),s=a.join("&")}if(s){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}}}),v=m({"node_modules/axios/lib/helpers/combineURLs.js"(e,t){t.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}}}),A=m({"node_modules/axios/lib/helpers/isAbsoluteURL.js"(e,t){t.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}}}),_=g(E()),C=g(v()),P=g(A());function T(e){const t=e?e.fetch:void 0,r=!(!e||!e.disableRequest);return function(e){return w(this,null,(function*(){const n=r&&e.url?e.url:function(e){const t=new Headers(e.headers);if(e.auth){const r=e.auth.username||"",n=e.auth.password?decodeURI(encodeURIComponent(e.auth.password)):"";t.set("Authorization",`Basic ${Buffer.from(r+":"+n).toString("base64")}`)}void 0===e.method&&(e.method="get");const r=e.method.toUpperCase(),n={headers:t,method:r};"GET"!==r&&"HEAD"!==r&&(n.body=e.data),void 0!==e.withCredentials&&(n.credentials=e.withCredentials?"include":"omit");const i=(o=e.url?e.url:"",c=e.baseURL,o&&c&&!(0,P.default)(o)?(0,C.default)(c,o):!o&&c?c:o),s=e.paramsSerializer?e.paramsSerializer:void 0,a=(0,_.default)(i,e.params,s);var o,c;return new Request(a,n)}(e),i=[x(n,e,t)];let s=null;e.timeout&&e.timeout>0&&i.push(new Promise(((t,r)=>{s=setTimeout((()=>{const t=e.timeoutErrorMessage?e.timeoutErrorMessage:"timeout of "+e.timeout+"ms exceeded";r(k(t,e,"ETIMEDOUT",n))}),e.timeout)})));const a=yield Promise.race(i);return null!==s&&clearTimeout(s),new Promise(((t,r)=>{if(a instanceof Error)r(a);else{const s=e.validateStatus;a.status&&s&&!s(a.status)?r(k("Request failed with status code "+a.status,e,(i=a.status,["ERR_BAD_REQUEST","ERR_BAD_RESPONSE"][Math.floor(i/100)-4]||"ERR_BAD_OPTION"),n,a)):t(a)}var i}))}))}}var O=T();function x(e,t){return w(this,arguments,(function*(e,t,r=fetch){let n;try{n=yield r(e)}catch(r){return k("Network Error",t,"ERR_NETWORK",e)}const i={};n.headers.forEach(((e,t)=>{i[t]=e}));const s=Object.assign({},i),a={status:n.status,statusText:n.statusText,headers:s,config:t,request:e,data:void 0};if(n.status>=200&&204!==n.status)switch(t.responseType){case"arraybuffer":a.data=yield n.arrayBuffer();break;case"blob":a.data=yield n.blob();break;case"json":a.data=yield n.json();break;default:a.data=yield n.text()}return y(f({},a),{ok:n.ok})}))}function k(e,t,r,n,i){const s=new Error(e);return s.config=t,s.code=r,s.request=n,s.response=i,s.isAxiosError=!0,s.toJSON=function(){return{message:this.message,name:this.name,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},s}},899:(e,t,r)=>{e.exports=r(860)},816:(e,t,r)=>{var n=r(652),i=r(776),s=r(484),a=r(640),o=r(784),c=r(320),l=r(104),u=r(108);e.exports=function(e){return new Promise((function(t,r){var d=e.data,h=e.headers,p=e.responseType;n.isFormData(d)&&delete h["Content-Type"];var f=new XMLHttpRequest;if(e.auth){var y=e.auth.username||"",m=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";h.Authorization="Basic "+btoa(y+":"+m)}var g=o(e.baseURL,e.url);function w(){if(f){var n="getAllResponseHeaders"in f?c(f.getAllResponseHeaders()):null,s={data:p&&"text"!==p&&"json"!==p?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f};i(t,r,s),f=null}}if(f.open(e.method.toUpperCase(),a(g,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,"onloadend"in f?f.onloadend=w:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(w)},f.onabort=function(){f&&(r(u("Request aborted",e,"ECONNABORTED",f)),f=null)},f.onerror=function(){r(u("Network Error",e,null,f)),f=null},f.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),r(u(t,e,e.transitional&&e.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",f)),f=null},n.isStandardBrowserEnv()){var b=(e.withCredentials||l(g))&&e.xsrfCookieName?s.read(e.xsrfCookieName):void 0;b&&(h[e.xsrfHeaderName]=b)}"setRequestHeader"in f&&n.forEach(h,(function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete h[t]:f.setRequestHeader(t,e)})),n.isUndefined(e.withCredentials)||(f.withCredentials=!!e.withCredentials),p&&"json"!==p&&(f.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&f.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){f&&(f.abort(),r(e),f=null)})),d||(d=null),f.send(d)}))}},860:(e,t,r)=>{var n=r(652),i=r(504),s=r(508),a=r(183);function o(e){var t=new s(e),r=i(s.prototype.request,t);return n.extend(r,s.prototype,t),n.extend(r,t),r}var c=o(r(528));c.Axios=s,c.create=function(e){return o(a(c.defaults,e))},c.Cancel=r(432),c.CancelToken=r(312),c.isCancel=r(864),c.all=function(e){return Promise.all(e)},c.spread=r(92),c.isAxiosError=r(288),e.exports=c,e.exports.default=c},432:e=>{function t(e){this.message=e}t.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},t.prototype.__CANCEL__=!0,e.exports=t},312:(e,t,r)=>{var n=r(432);function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;e((function(e){r.reason||(r.reason=new n(e),t(r.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},864:e=>{e.exports=function(e){return!(!e||!e.__CANCEL__)}},508:(e,t,r)=>{var n=r(652),i=r(640),s=r(747),a=r(88),o=r(183),c=r(984),l=c.validators;function u(e){this.defaults=e,this.interceptors={request:new s,response:new s}}u.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=o(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&c.assertOptions(t,{silentJSONParsing:l.transitional(l.boolean,"1.0.0"),forcedJSONParsing:l.transitional(l.boolean,"1.0.0"),clarifyTimeoutError:l.transitional(l.boolean,"1.0.0")},!1);var r=[],n=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(n=n&&t.synchronous,r.unshift(t.fulfilled,t.rejected))}));var i,s=[];if(this.interceptors.response.forEach((function(e){s.push(e.fulfilled,e.rejected)})),!n){var u=[a,void 0];for(Array.prototype.unshift.apply(u,r),u=u.concat(s),i=Promise.resolve(e);u.length;)i=i.then(u.shift(),u.shift());return i}for(var d=e;r.length;){var h=r.shift(),p=r.shift();try{d=h(d)}catch(e){p(e);break}}try{i=a(d)}catch(e){return Promise.reject(e)}for(;s.length;)i=i.then(s.shift(),s.shift());return i},u.prototype.getUri=function(e){return e=o(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],(function(e){u.prototype[e]=function(t,r){return this.request(o(r||{},{method:e,url:t,data:(r||{}).data}))}})),n.forEach(["post","put","patch"],(function(e){u.prototype[e]=function(t,r,n){return this.request(o(n||{},{method:e,url:t,data:r}))}})),e.exports=u},747:(e,t,r)=>{var n=r(652);function i(){this.handlers=[]}i.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){n.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},784:(e,t,r)=>{var n=r(992),i=r(344);e.exports=function(e,t){return e&&!n(t)?i(e,t):t}},108:(e,t,r)=>{var n=r(544);e.exports=function(e,t,r,i,s){var a=new Error(e);return n(a,t,r,i,s)}},88:(e,t,r)=>{var n=r(652),i=r(712),s=r(864),a=r(528);function o(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return o(e),e.headers=e.headers||{},e.data=i.call(e,e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),n.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||a.adapter)(e).then((function(t){return o(e),t.data=i.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return s(t)||(o(e),t&&t.response&&(t.response.data=i.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},544:e=>{e.exports=function(e,t,r,n,i){return e.config=t,r&&(e.code=r),e.request=n,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},183:(e,t,r)=>{var n=r(652);e.exports=function(e,t){t=t||{};var r={},i=["url","method","data"],s=["headers","auth","proxy","params"],a=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],o=["validateStatus"];function c(e,t){return n.isPlainObject(e)&&n.isPlainObject(t)?n.merge(e,t):n.isPlainObject(t)?n.merge({},t):n.isArray(t)?t.slice():t}function l(i){n.isUndefined(t[i])?n.isUndefined(e[i])||(r[i]=c(void 0,e[i])):r[i]=c(e[i],t[i])}n.forEach(i,(function(e){n.isUndefined(t[e])||(r[e]=c(void 0,t[e]))})),n.forEach(s,l),n.forEach(a,(function(i){n.isUndefined(t[i])?n.isUndefined(e[i])||(r[i]=c(void 0,e[i])):r[i]=c(void 0,t[i])})),n.forEach(o,(function(n){n in t?r[n]=c(e[n],t[n]):n in e&&(r[n]=c(void 0,e[n]))}));var u=i.concat(s).concat(a).concat(o),d=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===u.indexOf(e)}));return n.forEach(d,l),r}},776:(e,t,r)=>{var n=r(108);e.exports=function(e,t,r){var i=r.config.validateStatus;r.status&&i&&!i(r.status)?t(n("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}},712:(e,t,r)=>{var n=r(652),i=r(528);e.exports=function(e,t,r){var s=this||i;return n.forEach(r,(function(r){e=r.call(s,e,t)})),e}},528:(e,t,r)=>{var n=r(652),i=r(700),s=r(544),a={"Content-Type":"application/x-www-form-urlencoded"};function o(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var c,l={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(c=r(816)),c),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)?e:n.isArrayBufferView(e)?e.buffer:n.isURLSearchParams(e)?(o(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):n.isObject(e)||t&&"application/json"===t["Content-Type"]?(o(t,"application/json"),function(e,t,r){if(n.isString(e))try{return(0,JSON.parse)(e),n.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional,r=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,a=!r&&"json"===this.responseType;if(a||i&&n.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(a){if("SyntaxError"===e.name)throw s(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],(function(e){l.headers[e]={}})),n.forEach(["post","put","patch"],(function(e){l.headers[e]=n.merge(a)})),e.exports=l},504:e=>{e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}},640:(e,t,r)=>{var n=r(652);function i(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var s;if(r)s=r(t);else if(n.isURLSearchParams(t))s=t.toString();else{var a=[];n.forEach(t,(function(e,t){null!=e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,(function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),a.push(i(t)+"="+i(e))})))})),s=a.join("&")}if(s){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}},344:e=>{e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},484:(e,t,r)=>{var n=r(652);e.exports=n.isStandardBrowserEnv()?{write:function(e,t,r,i,s,a){var o=[];o.push(e+"="+encodeURIComponent(t)),n.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),n.isString(i)&&o.push("path="+i),n.isString(s)&&o.push("domain="+s),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},992:e=>{e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},288:e=>{e.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}},104:(e,t,r)=>{var n=r(652);e.exports=n.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=i(window.location.href),function(t){var r=n.isString(t)?i(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},700:(e,t,r)=>{var n=r(652);e.exports=function(e,t){n.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))}},320:(e,t,r)=>{var n=r(652),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,s,a={};return e?(n.forEach(e.split("\n"),(function(e){if(s=e.indexOf(":"),t=n.trim(e.substr(0,s)).toLowerCase(),r=n.trim(e.substr(s+1)),t){if(a[t]&&i.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([r]):a[t]?a[t]+", "+r:r}})),a):a}},92:e=>{e.exports=function(e){return function(t){return e.apply(null,t)}}},984:(e,t,r)=>{var n=r(706),i={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){i[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}}));var s={},a=n.version.split(".");function o(e,t){for(var r=t?t.split("."):a,n=e.split("."),i=0;i<3;i++){if(r[i]>n[i])return!0;if(r[i]<n[i])return!1}return!1}i.transitional=function(e,t,r){var i=t&&o(t);function a(e,t){return"[Axios v"+n.version+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(r,n,o){if(!1===e)throw new Error(a(n," has been removed in "+t));return i&&!s[n]&&(s[n]=!0,console.warn(a(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,n,o)}},e.exports={isOlderVersion:o,assertOptions:function(e,t,r){if("object"!=typeof e)throw new TypeError("options must be an object");for(var n=Object.keys(e),i=n.length;i-- >0;){var s=n[i],a=t[s];if(a){var o=e[s],c=void 0===o||a(o,s,e);if(!0!==c)throw new TypeError("option "+s+" must be "+c)}else if(!0!==r)throw Error("Unknown option "+s)}},validators:i}},652:(e,t,r)=>{var n=r(504),i=Object.prototype.toString;function s(e){return"[object Array]"===i.call(e)}function a(e){return void 0===e}function o(e){return null!==e&&"object"==typeof e}function c(e){if("[object Object]"!==i.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function l(e){return"[object Function]"===i.call(e)}function u(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),s(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:s,isArrayBuffer:function(e){return"[object ArrayBuffer]"===i.call(e)},isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:o,isPlainObject:c,isUndefined:a,isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:l,isStream:function(e){return o(e)&&l(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function e(){var t={};function r(r,n){c(t[n])&&c(r)?t[n]=e(t[n],r):c(r)?t[n]=e({},r):s(r)?t[n]=r.slice():t[n]=r}for(var n=0,i=arguments.length;n<i;n++)u(arguments[n],r);return t},extend:function(e,t,r){return u(t,(function(t,i){e[i]=r&&"function"==typeof t?n(t,r):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},604:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(r(899)),a=i(r(176)),o=r(580);t.default=class{constructor(e,t){this.projectId=e,this.keyFileContent=t,this.token="",this.tokenExpiry=null}createJWT(e,t,r){return n(this,void 0,void 0,(function*(){const n=yield(0,o.importPKCS8)(r,"RS256");return yield new o.SignJWT(t).setProtectedHeader(e).sign(n)}))}getAccessToken(e){return n(this,void 0,void 0,(function*(){if(this.token&&this.tokenExpiry&&this.tokenExpiry>Date.now())return this.token;const t=JSON.parse(this.keyFileContent),r=Math.floor(Date.now()/1e3),n=r+3600,i={alg:"RS256",typ:"JWT"},o={iss:t.client_email,sub:t.client_email,scope:e,aud:"https://oauth2.googleapis.com/token",iat:r,exp:n},c=yield this.createJWT(i,o,t.private_key),l=s.default.create({adapter:a.default}),u=yield l.post("https://oauth2.googleapis.com/token",{grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:c});return this.token=u.data.access_token,this.tokenExpiry=1e3*n,this.token}))}}},208:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=i(r(899)),a=i(r(604)),o=i(r(176));t.default=class{static logEntry(e,t,r,i){return n(this,void 0,void 0,(function*(){var n;const c=new a.default(e,t),l=yield c.getAccessToken("https://www.googleapis.com/auth/logging.write"),u={logName:`projects/${e}/logs/${r}`,resource:{type:"global"},entries:i};try{const e=s.default.create({adapter:o.default});yield e.post("https://logging.googleapis.com/v2/entries:write",u,{headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}})}catch(e){console.error(`Error logging to ${r}:`,(null===(n=e.response)||void 0===n?void 0:n.data)||e.message)}}))}}},580:(e,t,r)=>{r.r(t),r.d(t,{CompactEncrypt:()=>nt,CompactSign:()=>st,EmbeddedJWK:()=>yt,EncryptJWT:()=>dt,FlattenedEncrypt:()=>Ue,FlattenedSign:()=>it,GeneralEncrypt:()=>Be,GeneralSign:()=>ot,SignJWT:()=>ut,UnsecuredJWT:()=>_t,base64url:()=>i,calculateJwkThumbprint:()=>pt,calculateJwkThumbprintUri:()=>ft,compactDecrypt:()=>He,compactVerify:()=>ze,createLocalJWKSet:()=>St,createRemoteJWKSet:()=>At,cryptoRuntime:()=>Nt,decodeJwt:()=>Ot,decodeProtectedHeader:()=>Tt,errors:()=>n,exportJWK:()=>Ie,exportPKCS8:()=>De,exportSPKI:()=>$e,flattenedDecrypt:()=>Ne,flattenedVerify:()=>Fe,generalDecrypt:()=>je,generalVerify:()=>Ve,generateKeyPair:()=>kt,generateSecret:()=>Rt,importJWK:()=>Pe,importPKCS8:()=>Ce,importSPKI:()=>Ae,importX509:()=>_e,jwtDecrypt:()=>rt,jwtVerify:()=>tt});var n={};r.r(n),r.d(n,{JOSEAlgNotAllowed:()=>A,JOSEError:()=>S,JOSENotSupported:()=>_,JWEDecryptionFailed:()=>C,JWEInvalid:()=>P,JWKInvalid:()=>x,JWKSInvalid:()=>k,JWKSMultipleMatchingKeys:()=>N,JWKSNoMatchingKey:()=>R,JWKSTimeout:()=>H,JWSInvalid:()=>T,JWSSignatureVerificationFailed:()=>j,JWTClaimValidationFailed:()=>E,JWTExpired:()=>v,JWTInvalid:()=>O});var i={};r.r(i),r.d(i,{decode:()=>Pt,encode:()=>Ct});const s=crypto,a=e=>e instanceof CryptoKey,o=async(e,t)=>{const r=`SHA-${e.slice(-3)}`;return new Uint8Array(await s.subtle.digest(r,t))},c=new TextEncoder,l=new TextDecoder,u=2**32;function d(...e){const t=e.reduce(((e,{length:t})=>e+t),0),r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}function h(e,t,r){if(t<0||t>=u)throw new RangeError(`value must be >= 0 and <= ${u-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function p(e){const t=Math.floor(e/u),r=e%u,n=new Uint8Array(8);return h(n,t,0),h(n,r,4),n}function f(e){const t=new Uint8Array(4);return h(t,e),t}function y(e){return d(f(e.length),e)}const m=e=>{let t=e;"string"==typeof t&&(t=c.encode(t));const r=[];for(let e=0;e<t.length;e+=32768)r.push(String.fromCharCode.apply(null,t.subarray(e,e+32768)));return btoa(r.join(""))},g=e=>m(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),w=e=>{const t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r},b=e=>{let t=e;t instanceof Uint8Array&&(t=l.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return w(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class S extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class E extends S{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t,r="unspecified",n="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=r,this.reason=n,this.payload=t}}class v extends S{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t,r="unspecified",n="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=r,this.reason=n,this.payload=t}}class A extends S{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class _ extends S{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class C extends S{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}}class P extends S{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}}class T extends S{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class O extends S{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}class x extends S{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}}class k extends S{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}}class R extends S{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}}class N extends S{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}Symbol.asyncIterator;class H extends S{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}}class j extends S{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}const K=s.getRandomValues.bind(s);function $(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new _(`Unsupported JWE Algorithm: ${e}`)}}const D=(e,t)=>{if(t.length<<3!==$(e))throw new P("Invalid Initialization Vector length")},I=(e,t)=>{const r=e.byteLength<<3;if(r!==t)throw new P(`Invalid Content Encryption Key length. Expected ${t} bits, got ${r} bits`)};function J(e,t="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function W(e,t){return e.name===t}function U(e){return parseInt(e.name.slice(4),10)}function L(e,t){if(t.length&&!t.some((t=>e.usages.includes(t)))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){const r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw new TypeError(e)}}function B(e,t,...r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!W(e.algorithm,"AES-GCM"))throw J("AES-GCM");const r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw J(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!W(e.algorithm,"AES-KW"))throw J("AES-KW");const r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw J(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw J("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!W(e.algorithm,"PBKDF2"))throw J("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!W(e.algorithm,"RSA-OAEP"))throw J("RSA-OAEP");const r=parseInt(t.slice(9),10)||1;if(U(e.algorithm.hash)!==r)throw J(`SHA-${r}`,"algorithm.hash");break}default:throw new TypeError("CryptoKey does not support this operation")}L(e,r)}function M(e,t,...r){if(r.length>2){const t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}const q=(e,...t)=>M("Key must be ",e,...t);function Q(e,t,...r){return M(`Key for the ${e} algorithm must be `,t,...r)}const F=e=>a(e),z=["CryptoKey"],V=async(e,t,r,n,i,o)=>{if(!(a(t)||t instanceof Uint8Array))throw new TypeError(q(t,...z,"Uint8Array"));if(!n)throw new P("JWE Initialization Vector missing");if(!i)throw new P("JWE Authentication Tag missing");switch(D(e,n),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&I(t,parseInt(e.slice(-3),10)),async function(e,t,r,n,i,a){if(!(t instanceof Uint8Array))throw new TypeError(q(t,"Uint8Array"));const o=parseInt(e.slice(1,4),10),c=await s.subtle.importKey("raw",t.subarray(o>>3),"AES-CBC",!1,["decrypt"]),l=await s.subtle.importKey("raw",t.subarray(0,o>>3),{hash:"SHA-"+(o<<1),name:"HMAC"},!1,["sign"]),u=d(a,n,r,p(a.length<<3)),h=new Uint8Array((await s.subtle.sign("HMAC",l,u)).slice(0,o>>3));let f,y;try{f=((e,t)=>{if(!(e instanceof Uint8Array))throw new TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw new TypeError("Second argument must be a buffer");if(e.length!==t.length)throw new TypeError("Input buffers must have the same length");const r=e.length;let n=0,i=-1;for(;++i<r;)n|=e[i]^t[i];return 0===n})(i,h)}catch{}if(!f)throw new C;try{y=new Uint8Array(await s.subtle.decrypt({iv:n,name:"AES-CBC"},c,r))}catch{}if(!y)throw new C;return y}(e,t,r,n,i,o);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&I(t,parseInt(e.slice(1,4),10)),async function(e,t,r,n,i,a){let o;t instanceof Uint8Array?o=await s.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(B(t,e,"decrypt"),o=t);try{return new Uint8Array(await s.subtle.decrypt({additionalData:a,iv:n,name:"AES-GCM",tagLength:128},o,d(r,i)))}catch{throw new C}}(e,t,r,n,i,o);default:throw new _("Unsupported JWE Content Encryption Algorithm")}},G=(...e)=>{const t=e.filter(Boolean);if(0===t.length||1===t.length)return!0;let r;for(const e of t){const t=Object.keys(e);if(r&&0!==r.size)for(const e of t){if(r.has(e))return!1;r.add(e)}else r=new Set(t)}return!0};function X(e){if("object"!=typeof(t=e)||null===t||"[object Object]"!==Object.prototype.toString.call(e))return!1;var t;if(null===Object.getPrototypeOf(e))return!0;let r=e;for(;null!==Object.getPrototypeOf(r);)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}const Y=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]];function Z(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw new TypeError(`Invalid key size for alg: ${t}`)}function ee(e,t,r){if(a(e))return B(e,t,r),e;if(e instanceof Uint8Array)return s.subtle.importKey("raw",e,"AES-KW",!0,[r]);throw new TypeError(q(e,...z,"Uint8Array"))}const te=async(e,t,r)=>{const n=await ee(t,e,"wrapKey");Z(n,e);const i=await s.subtle.importKey("raw",r,...Y);return new Uint8Array(await s.subtle.wrapKey("raw",i,n,"AES-KW"))},re=async(e,t,r)=>{const n=await ee(t,e,"unwrapKey");Z(n,e);const i=await s.subtle.unwrapKey("raw",r,n,"AES-KW",...Y);return new Uint8Array(await s.subtle.exportKey("raw",i))};async function ne(e,t,r,n,i=new Uint8Array(0),l=new Uint8Array(0)){if(!a(e))throw new TypeError(q(e,...z));if(B(e,"ECDH"),!a(t))throw new TypeError(q(t,...z));B(t,"ECDH","deriveBits");const u=d(y(c.encode(r)),y(i),y(l),f(n));let h;return h="X25519"===e.algorithm.name?256:"X448"===e.algorithm.name?448:Math.ceil(parseInt(e.algorithm.namedCurve.substr(-3),10)/8)<<3,async function(e,t,r){const n=Math.ceil((t>>3)/32),i=new Uint8Array(32*n);for(let t=0;t<n;t++){const n=new Uint8Array(4+e.length+r.length);n.set(f(t+1)),n.set(e,4),n.set(r,4+e.length),i.set(await o("sha256",n),32*t)}return i.slice(0,t>>3)}(new Uint8Array(await s.subtle.deriveBits({name:e.algorithm.name,public:e},t,h)),n,u)}function ie(e){if(!a(e))throw new TypeError(q(e,...z));return["P-256","P-384","P-521"].includes(e.algorithm.namedCurve)||"X25519"===e.algorithm.name||"X448"===e.algorithm.name}async function se(e,t,r,n){!function(e){if(!(e instanceof Uint8Array)||e.length<8)throw new P("PBES2 Salt Input must be 8 or more octets")}(e);const i=function(e,t){return d(c.encode(e),new Uint8Array([0]),t)}(t,e),o=parseInt(t.slice(13,16),10),l={hash:`SHA-${t.slice(8,11)}`,iterations:r,name:"PBKDF2",salt:i},u={length:o,name:"AES-KW"},h=await function(e,t){if(e instanceof Uint8Array)return s.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits"]);if(a(e))return B(e,t,"deriveBits","deriveKey"),e;throw new TypeError(q(e,...z,"Uint8Array"))}(n,t);if(h.usages.includes("deriveBits"))return new Uint8Array(await s.subtle.deriveBits(l,h,o));if(h.usages.includes("deriveKey"))return s.subtle.deriveKey(l,h,u,!1,["wrapKey","unwrapKey"]);throw new TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}function ae(e){switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new _(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}const oe=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};function ce(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new _(`Unsupported JWE Algorithm: ${e}`)}}const le=e=>K(new Uint8Array(ce(e)>>3)),ue=(e,t)=>`-----BEGIN ${t}-----\n${(e.match(/.{1,64}/g)||[]).join("\n")}\n-----END ${t}-----`,de=async(e,t,r)=>{if(!a(r))throw new TypeError(q(r,...z));if(!r.extractable)throw new TypeError("CryptoKey is not extractable");if(r.type!==e)throw new TypeError(`key is not a ${e} key`);return ue(m(new Uint8Array(await s.subtle.exportKey(t,r))),`${e.toUpperCase()} KEY`)},he=e=>de("public","spki",e),pe=e=>de("private","pkcs8",e),fe=(e,t,r=0)=>{0===r&&(t.unshift(t.length),t.unshift(6));const n=e.indexOf(t[0],r);if(-1===n)return!1;const i=e.subarray(n,n+t.length);return i.length===t.length&&(i.every(((e,r)=>e===t[r]))||fe(e,t,n+1))},ye=e=>{switch(!0){case fe(e,[42,134,72,206,61,3,1,7]):return"P-256";case fe(e,[43,129,4,0,34]):return"P-384";case fe(e,[43,129,4,0,35]):return"P-521";case fe(e,[43,101,110]):return"X25519";case fe(e,[43,101,111]):return"X448";case fe(e,[43,101,112]):return"Ed25519";case fe(e,[43,101,113]):return"Ed448";default:throw new _("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},me=async(e,t,r,n,i)=>{let a,o;const c=new Uint8Array(atob(r.replace(e,"")).split("").map((e=>e.charCodeAt(0)))),l="spki"===t;switch(n){case"PS256":case"PS384":case"PS512":a={name:"RSA-PSS",hash:`SHA-${n.slice(-3)}`},o=l?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":a={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${n.slice(-3)}`},o=l?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":a={name:"RSA-OAEP",hash:`SHA-${parseInt(n.slice(-3),10)||1}`},o=l?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":a={name:"ECDSA",namedCurve:"P-256"},o=l?["verify"]:["sign"];break;case"ES384":a={name:"ECDSA",namedCurve:"P-384"},o=l?["verify"]:["sign"];break;case"ES512":a={name:"ECDSA",namedCurve:"P-521"},o=l?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{const e=ye(c);a=e.startsWith("P-")?{name:"ECDH",namedCurve:e}:{name:e},o=l?[]:["deriveBits"];break}case"EdDSA":a={name:ye(c)},o=l?["verify"]:["sign"];break;default:throw new _('Invalid or unsupported "alg" (Algorithm) value')}return s.subtle.importKey(t,c,a,i?.extractable??!1,o)},ge=(e,t,r)=>me(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",e,t,r),we=(e,t,r)=>me(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",e,t,r);function be(e){const t=[];let r=0;for(;r<e.length;){const n=Se(e.subarray(r));t.push(n),r+=n.byteLength}return t}function Se(e){let t=0,r=31&e[0];if(t++,31===r){for(r=0;e[t]>=128;)r=128*r+e[t]-128,t++;r=128*r+e[t]-128,t++}let n=0;if(e[t]<128)n=e[t],t++;else{if(128===n){for(n=0;0!==e[t+n]||0!==e[t+n+1];){if(n>e.byteLength)throw new TypeError("invalid indefinite form length");n++}const r=t+n+2;return{byteLength:r,contents:e.subarray(t,t+n),raw:e.subarray(0,r)}}{const r=127&e[t];t++,n=0;for(let i=0;i<r;i++)n=256*n+e[t],t++}}const i=t+n;return{byteLength:i,contents:e.subarray(t,i),raw:e.subarray(0,i)}}const Ee=(e,t,r)=>{let n;try{n=function(e){const t=e.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g,""),r=w(t);return ue(function(e){const t=be(be(Se(e).contents)[0].contents);return m(t[160===t[0].raw[0]?6:5].raw)}(r),"PUBLIC KEY")}(e)}catch(e){throw new TypeError("Failed to parse the X.509 certificate",{cause:e})}return we(n,t,r)},ve=async e=>{if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:t,keyUsages:r}=function(e){let t,r;switch(e.kty){case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new _('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new _('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"EdDSA":t={name:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new _('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new _('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),n=[t,e.ext??!1,e.key_ops??r],i={...e};return delete i.alg,delete i.use,s.subtle.importKey("jwk",i,...n)};async function Ae(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PUBLIC KEY-----"))throw new TypeError('"spki" must be SPKI formatted string');return we(e,t,r)}async function _e(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN CERTIFICATE-----"))throw new TypeError('"x509" must be X.509 formatted string');return Ee(e,t,r)}async function Ce(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return ge(e,t,r)}async function Pe(e,t){if(!X(e))throw new TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return b(e.k);case"RSA":if(void 0!==e.oth)throw new _('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return ve({...e,alg:t});default:throw new _('Unsupported "kty" (Key Type) Parameter value')}}const Te=(e,t,r)=>{e.startsWith("HS")||"dir"===e||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?((e,t)=>{if(!(t instanceof Uint8Array)){if(!F(t))throw new TypeError(Q(e,t,...z,"Uint8Array"));if("secret"!==t.type)throw new TypeError(`${z.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}})(e,t):((e,t,r)=>{if(!F(t))throw new TypeError(Q(e,t,...z));if("secret"===t.type)throw new TypeError(`${z.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw new TypeError(`${z.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw new TypeError(`${z.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw new TypeError(`${z.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw new TypeError(`${z.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)})(e,t,r)},Oe=async(e,t,r,n,i)=>{if(!(a(r)||r instanceof Uint8Array))throw new TypeError(q(r,...z,"Uint8Array"));switch(n?D(e,n):n=K(new Uint8Array($(e)>>3)),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r instanceof Uint8Array&&I(r,parseInt(e.slice(-3),10)),async function(e,t,r,n,i){if(!(r instanceof Uint8Array))throw new TypeError(q(r,"Uint8Array"));const a=parseInt(e.slice(1,4),10),o=await s.subtle.importKey("raw",r.subarray(a>>3),"AES-CBC",!1,["encrypt"]),c=await s.subtle.importKey("raw",r.subarray(0,a>>3),{hash:"SHA-"+(a<<1),name:"HMAC"},!1,["sign"]),l=new Uint8Array(await s.subtle.encrypt({iv:n,name:"AES-CBC"},o,t)),u=d(i,n,l,p(i.length<<3));return{ciphertext:l,tag:new Uint8Array((await s.subtle.sign("HMAC",c,u)).slice(0,a>>3)),iv:n}}(e,t,r,n,i);case"A128GCM":case"A192GCM":case"A256GCM":return r instanceof Uint8Array&&I(r,parseInt(e.slice(1,4),10)),async function(e,t,r,n,i){let a;r instanceof Uint8Array?a=await s.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]):(B(r,e,"encrypt"),a=r);const o=new Uint8Array(await s.subtle.encrypt({additionalData:i,iv:n,name:"AES-GCM",tagLength:128},a,t)),c=o.slice(-16);return{ciphertext:o.slice(0,-16),tag:c,iv:n}}(e,t,r,n,i);default:throw new _("Unsupported JWE Content Encryption Algorithm")}},xe=async function(e,t,r,n,i){switch(Te(e,t,"decrypt"),e){case"dir":if(void 0!==r)throw new P("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new P("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!X(n.epk))throw new P('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!ie(t))throw new _("ECDH with the provided key is not allowed or not supported by your javascript runtime");const i=await Pe(n.epk,e);let s,a;if(void 0!==n.apu){if("string"!=typeof n.apu)throw new P('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{s=b(n.apu)}catch{throw new P("Failed to base64url decode the apu")}}if(void 0!==n.apv){if("string"!=typeof n.apv)throw new P('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{a=b(n.apv)}catch{throw new P("Failed to base64url decode the apv")}}const o=await ne(i,t,"ECDH-ES"===e?n.enc:e,"ECDH-ES"===e?ce(n.enc):parseInt(e.slice(-5,-2),10),s,a);if("ECDH-ES"===e)return o;if(void 0===r)throw new P("JWE Encrypted Key missing");return re(e.slice(-6),o,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new P("JWE Encrypted Key missing");return(async(e,t,r)=>{if(!a(t))throw new TypeError(q(t,...z));if(B(t,e,"decrypt","unwrapKey"),oe(e,t),t.usages.includes("decrypt"))return new Uint8Array(await s.subtle.decrypt(ae(e),t,r));if(t.usages.includes("unwrapKey")){const n=await s.subtle.unwrapKey("raw",r,t,ae(e),...Y);return new Uint8Array(await s.subtle.exportKey("raw",n))}throw new TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')})(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(void 0===r)throw new P("JWE Encrypted Key missing");if("number"!=typeof n.p2c)throw new P('JOSE Header "p2c" (PBES2 Count) missing or invalid');const s=i?.maxPBES2Count||1e4;if(n.p2c>s)throw new P('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof n.p2s)throw new P('JOSE Header "p2s" (PBES2 Salt) missing or invalid');let a;try{a=b(n.p2s)}catch{throw new P("Failed to base64url decode the p2s")}return(async(e,t,r,n,i)=>{const s=await se(i,e,n,t);return re(e.slice(-6),s,r)})(e,t,r,n.p2c,a)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new P("JWE Encrypted Key missing");return re(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{if(void 0===r)throw new P("JWE Encrypted Key missing");if("string"!=typeof n.iv)throw new P('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof n.tag)throw new P('JOSE Header "tag" (Authentication Tag) missing or invalid');let i,s;try{i=b(n.iv)}catch{throw new P("Failed to base64url decode the iv")}try{s=b(n.tag)}catch{throw new P("Failed to base64url decode the tag")}return async function(e,t,r,n,i){const s=e.slice(0,7);return V(s,t,r,n,i,new Uint8Array(0))}(e,t,r,i,s)}default:throw new _('Invalid or unsupported "alg" (JWE Algorithm) header value')}},ke=function(e,t,r,n,i){if(void 0!==i.crit&&void 0===n?.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||void 0===n.crit)return new Set;if(!Array.isArray(n.crit)||0===n.crit.length||n.crit.some((e=>"string"!=typeof e||0===e.length)))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let s;s=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t;for(const t of n.crit){if(!s.has(t))throw new _(`Extension Header Parameter "${t}" is not recognized`);if(void 0===i[t])throw new e(`Extension Header Parameter "${t}" is missing`);if(s.get(t)&&void 0===n[t])throw new e(`Extension Header Parameter "${t}" MUST be integrity protected`)}return new Set(n.crit)},Re=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some((e=>"string"!=typeof e))))throw new TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};async function Ne(e,t,r){if(!X(e))throw new P("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new P("JOSE Header missing");if(void 0!==e.iv&&"string"!=typeof e.iv)throw new P("JWE Initialization Vector incorrect type");if("string"!=typeof e.ciphertext)throw new P("JWE Ciphertext missing or incorrect type");if(void 0!==e.tag&&"string"!=typeof e.tag)throw new P("JWE Authentication Tag incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new P("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new P("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new P("JWE AAD incorrect type");if(void 0!==e.header&&!X(e.header))throw new P("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!X(e.unprotected))throw new P("JWE Per-Recipient Unprotected Header incorrect type");let n;if(e.protected)try{const t=b(e.protected);n=JSON.parse(l.decode(t))}catch{throw new P("JWE Protected Header is invalid")}if(!G(n,e.header,e.unprotected))throw new P("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");const i={...n,...e.header,...e.unprotected};if(ke(P,new Map,r?.crit,n,i),void 0!==i.zip)throw new _('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');const{alg:s,enc:a}=i;if("string"!=typeof s||!s)throw new P("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof a||!a)throw new P("missing JWE Encryption Algorithm (enc) in JWE Header");const o=r&&Re("keyManagementAlgorithms",r.keyManagementAlgorithms),u=r&&Re("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(o&&!o.has(s)||!o&&s.startsWith("PBES2"))throw new A('"alg" (Algorithm) Header Parameter value not allowed');if(u&&!u.has(a))throw new A('"enc" (Encryption Algorithm) Header Parameter value not allowed');let h;if(void 0!==e.encrypted_key)try{h=b(e.encrypted_key)}catch{throw new P("Failed to base64url decode the encrypted_key")}let p,f,y,m=!1;"function"==typeof t&&(t=await t(n,e),m=!0);try{p=await xe(s,t,h,i,r)}catch(e){if(e instanceof TypeError||e instanceof P||e instanceof _)throw e;p=le(a)}if(void 0!==e.iv)try{f=b(e.iv)}catch{throw new P("Failed to base64url decode the iv")}if(void 0!==e.tag)try{y=b(e.tag)}catch{throw new P("Failed to base64url decode the tag")}const g=c.encode(e.protected??"");let w,S;w=void 0!==e.aad?d(g,c.encode("."),c.encode(e.aad)):g;try{S=b(e.ciphertext)}catch{throw new P("Failed to base64url decode the ciphertext")}const E={plaintext:await V(a,p,S,f,y,w)};if(void 0!==e.protected&&(E.protectedHeader=n),void 0!==e.aad)try{E.additionalAuthenticatedData=b(e.aad)}catch{throw new P("Failed to base64url decode the aad")}return void 0!==e.unprotected&&(E.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(E.unprotectedHeader=e.header),m?{...E,key:t}:E}async function He(e,t,r){if(e instanceof Uint8Array&&(e=l.decode(e)),"string"!=typeof e)throw new P("Compact JWE must be a string or Uint8Array");const{0:n,1:i,2:s,3:a,4:o,length:c}=e.split(".");if(5!==c)throw new P("Invalid Compact JWE");const u=await Ne({ciphertext:a,iv:s||void 0,protected:n,tag:o||void 0,encrypted_key:i||void 0},t,r),d={plaintext:u.plaintext,protectedHeader:u.protectedHeader};return"function"==typeof t?{...d,key:u.key}:d}async function je(e,t,r){if(!X(e))throw new P("General JWE must be an object");if(!Array.isArray(e.recipients)||!e.recipients.every(X))throw new P("JWE Recipients missing or incorrect type");if(!e.recipients.length)throw new P("JWE Recipients has no members");for(const n of e.recipients)try{return await Ne({aad:e.aad,ciphertext:e.ciphertext,encrypted_key:n.encrypted_key,header:n.header,iv:e.iv,protected:e.protected,tag:e.tag,unprotected:e.unprotected},t,r)}catch{}throw new C}const Ke=async e=>{if(e instanceof Uint8Array)return{kty:"oct",k:g(e)};if(!a(e))throw new TypeError(q(e,...z,"Uint8Array"));if(!e.extractable)throw new TypeError("non-extractable CryptoKey cannot be exported as a JWK");const{ext:t,key_ops:r,alg:n,use:i,...o}=await s.subtle.exportKey("jwk",e);return o};async function $e(e){return he(e)}async function De(e){return pe(e)}async function Ie(e){return Ke(e)}const Je=async function(e,t,r,n,i={}){let o,c,l;switch(Te(e,r,"encrypt"),e){case"dir":l=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!ie(r))throw new _("ECDH with the provided key is not allowed or not supported by your javascript runtime");const{apu:u,apv:d}=i;let{epk:h}=i;h||(h=(await async function(e){if(!a(e))throw new TypeError(q(e,...z));return s.subtle.generateKey(e.algorithm,!0,["deriveBits"])}(r)).privateKey);const{x:p,y:f,crv:y,kty:m}=await Ie(h),w=await ne(r,h,"ECDH-ES"===e?t:e,"ECDH-ES"===e?ce(t):parseInt(e.slice(-5,-2),10),u,d);if(c={epk:{x:p,crv:y,kty:m}},"EC"===m&&(c.epk.y=f),u&&(c.apu=g(u)),d&&(c.apv=g(d)),"ECDH-ES"===e){l=w;break}l=n||le(t);const b=e.slice(-6);o=await te(b,w,l);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":l=n||le(t),o=await(async(e,t,r)=>{if(!a(t))throw new TypeError(q(t,...z));if(B(t,e,"encrypt","wrapKey"),oe(e,t),t.usages.includes("encrypt"))return new Uint8Array(await s.subtle.encrypt(ae(e),t,r));if(t.usages.includes("wrapKey")){const n=await s.subtle.importKey("raw",r,...Y);return new Uint8Array(await s.subtle.wrapKey("raw",n,t,ae(e)))}throw new TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')})(e,r,l);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{l=n||le(t);const{p2c:s,p2s:a}=i;({encryptedKey:o,...c}=await(async(e,t,r,n=2048,i=K(new Uint8Array(16)))=>{const s=await se(i,e,n,t);return{encryptedKey:await te(e.slice(-6),s,r),p2c:n,p2s:g(i)}})(e,r,l,s,a));break}case"A128KW":case"A192KW":case"A256KW":l=n||le(t),o=await te(e,r,l);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{l=n||le(t);const{iv:s}=i;({encryptedKey:o,...c}=await async function(e,t,r,n){const i=e.slice(0,7),s=await Oe(i,r,t,n,new Uint8Array(0));return{encryptedKey:s.ciphertext,iv:g(s.iv),tag:g(s.tag)}}(e,r,l,s));break}default:throw new _('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:l,encryptedKey:o,parameters:c}},We=Symbol();class Ue{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,t){if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new P("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!G(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new P("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");const r={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(ke(P,new Map,t?.crit,this._protectedHeader,r),void 0!==r.zip)throw new _('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');const{alg:n,enc:i}=r;if("string"!=typeof n||!n)throw new P('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof i||!i)throw new P('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');let s,a,o,u,h;if(this._cek&&("dir"===n||"ECDH-ES"===n))throw new TypeError(`setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header ${n}`);{let r;({cek:a,encryptedKey:s,parameters:r}=await Je(n,i,e,this._cek,this._keyManagementParameters)),r&&(t&&We in t?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...r}:this.setUnprotectedHeader(r):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...r}:this.setProtectedHeader(r))}u=this._protectedHeader?c.encode(g(JSON.stringify(this._protectedHeader))):c.encode(""),this._aad?(h=g(this._aad),o=d(u,c.encode("."),c.encode(h))):o=u;const{ciphertext:p,tag:f,iv:y}=await Oe(i,this._plaintext,a,this._iv,o),m={ciphertext:g(p)};return y&&(m.iv=g(y)),f&&(m.tag=g(f)),s&&(m.encrypted_key=g(s)),h&&(m.aad=h),this._protectedHeader&&(m.protected=l.decode(u)),this._sharedUnprotectedHeader&&(m.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(m.header=this._unprotectedHeader),m}}class Le{constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setUnprotectedHeader(e){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addRecipient(...e){return this.parent.addRecipient(...e)}encrypt(...e){return this.parent.encrypt(...e)}done(){return this.parent}}class Be{constructor(e){this._recipients=[],this._plaintext=e}addRecipient(e,t){const r=new Le(this,e,{crit:t?.crit});return this._recipients.push(r),r}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}async encrypt(){if(!this._recipients.length)throw new P("at least one recipient must be added");if(1===this._recipients.length){const[e]=this._recipients,t=await new Ue(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(e.unprotectedHeader).encrypt(e.key,{...e.options}),r={ciphertext:t.ciphertext,iv:t.iv,recipients:[{}],tag:t.tag};return t.aad&&(r.aad=t.aad),t.protected&&(r.protected=t.protected),t.unprotected&&(r.unprotected=t.unprotected),t.encrypted_key&&(r.recipients[0].encrypted_key=t.encrypted_key),t.header&&(r.recipients[0].header=t.header),r}let e;for(let t=0;t<this._recipients.length;t++){const r=this._recipients[t];if(!G(this._protectedHeader,this._unprotectedHeader,r.unprotectedHeader))throw new P("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");const n={...this._protectedHeader,...this._unprotectedHeader,...r.unprotectedHeader},{alg:i}=n;if("string"!=typeof i||!i)throw new P('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("dir"===i||"ECDH-ES"===i)throw new P('"dir" and "ECDH-ES" alg may only be used with a single recipient');if("string"!=typeof n.enc||!n.enc)throw new P('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(e){if(e!==n.enc)throw new P('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients')}else e=n.enc;if(ke(P,new Map,r.options.crit,this._protectedHeader,n),void 0!==n.zip)throw new _('JWE "zip" (Compression Algorithm) Header Parameter is not supported.')}const t=le(e),r={ciphertext:"",iv:"",recipients:[],tag:""};for(let n=0;n<this._recipients.length;n++){const i=this._recipients[n],s={};r.recipients.push(s);const a={...this._protectedHeader,...this._unprotectedHeader,...i.unprotectedHeader}.alg.startsWith("PBES2")?2048+n:void 0;if(0===n){const e=await new Ue(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(t).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(i.unprotectedHeader).setKeyManagementParameters({p2c:a}).encrypt(i.key,{...i.options,[We]:!0});r.ciphertext=e.ciphertext,r.iv=e.iv,r.tag=e.tag,e.aad&&(r.aad=e.aad),e.protected&&(r.protected=e.protected),e.unprotected&&(r.unprotected=e.unprotected),s.encrypted_key=e.encrypted_key,e.header&&(s.header=e.header);continue}const{encryptedKey:o,parameters:c}=await Je(i.unprotectedHeader?.alg||this._protectedHeader?.alg||this._unprotectedHeader?.alg,e,i.key,t,{p2c:a});s.encrypted_key=g(o),(i.unprotectedHeader||c)&&(s.header={...i.unprotectedHeader,...c})}return r}}function Me(e,t){const r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"EdDSA":return{name:t.name};default:throw new _(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}function qe(e,t,r){if(a(t))return function(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!W(e.algorithm,"HMAC"))throw J("HMAC");const r=parseInt(t.slice(2),10);if(U(e.algorithm.hash)!==r)throw J(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!W(e.algorithm,"RSASSA-PKCS1-v1_5"))throw J("RSASSA-PKCS1-v1_5");const r=parseInt(t.slice(2),10);if(U(e.algorithm.hash)!==r)throw J(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!W(e.algorithm,"RSA-PSS"))throw J("RSA-PSS");const r=parseInt(t.slice(2),10);if(U(e.algorithm.hash)!==r)throw J(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw J("Ed25519 or Ed448");break;case"ES256":case"ES384":case"ES512":{if(!W(e.algorithm,"ECDSA"))throw J("ECDSA");const r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw J(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}L(e,r)}(t,e,r),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(q(t,...z));return s.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(q(t,...z,"Uint8Array"))}const Qe=async(e,t,r,n)=>{const i=await qe(e,t,"verify");oe(e,i);const a=Me(e,i.algorithm);try{return await s.subtle.verify(a,i,r,n)}catch{return!1}};async function Fe(e,t,r){if(!X(e))throw new T("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new T('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new T("JWS Protected Header incorrect type");if(void 0===e.payload)throw new T("JWS Payload missing");if("string"!=typeof e.signature)throw new T("JWS Signature missing or incorrect type");if(void 0!==e.header&&!X(e.header))throw new T("JWS Unprotected Header incorrect type");let n={};if(e.protected)try{const t=b(e.protected);n=JSON.parse(l.decode(t))}catch{throw new T("JWS Protected Header is invalid")}if(!G(n,e.header))throw new T("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const i={...n,...e.header};let s=!0;if(ke(T,new Map([["b64",!0]]),r?.crit,n,i).has("b64")&&(s=n.b64,"boolean"!=typeof s))throw new T('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:a}=i;if("string"!=typeof a||!a)throw new T('JWS "alg" (Algorithm) Header Parameter missing or invalid');const o=r&&Re("algorithms",r.algorithms);if(o&&!o.has(a))throw new A('"alg" (Algorithm) Header Parameter value not allowed');if(s){if("string"!=typeof e.payload)throw new T("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new T("JWS Payload must be a string or an Uint8Array instance");let u=!1;"function"==typeof t&&(t=await t(n,e),u=!0),Te(a,t,"verify");const h=d(c.encode(e.protected??""),c.encode("."),"string"==typeof e.payload?c.encode(e.payload):e.payload);let p,f;try{p=b(e.signature)}catch{throw new T("Failed to base64url decode the signature")}if(!await Qe(a,t,p,h))throw new j;if(s)try{f=b(e.payload)}catch{throw new T("Failed to base64url decode the payload")}else f="string"==typeof e.payload?c.encode(e.payload):e.payload;const y={payload:f};return void 0!==e.protected&&(y.protectedHeader=n),void 0!==e.header&&(y.unprotectedHeader=e.header),u?{...y,key:t}:y}async function ze(e,t,r){if(e instanceof Uint8Array&&(e=l.decode(e)),"string"!=typeof e)throw new T("Compact JWS must be a string or Uint8Array");const{0:n,1:i,2:s,length:a}=e.split(".");if(3!==a)throw new T("Invalid Compact JWS");const o=await Fe({payload:i,protected:n,signature:s},t,r),c={payload:o.payload,protectedHeader:o.protectedHeader};return"function"==typeof t?{...c,key:o.key}:c}async function Ve(e,t,r){if(!X(e))throw new T("General JWS must be an object");if(!Array.isArray(e.signatures)||!e.signatures.every(X))throw new T("JWS Signatures missing or incorrect type");for(const n of e.signatures)try{return await Fe({header:n.header,payload:e.payload,protected:n.protected,signature:n.signature},t,r)}catch{}throw new j}const Ge=e=>Math.floor(e.getTime()/1e3),Xe=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Ye=e=>{const t=Xe.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const r=parseFloat(t[2]);let n;switch(t[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":n=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":n=Math.round(60*r);break;case"hour":case"hours":case"hr":case"hrs":case"h":n=Math.round(3600*r);break;case"day":case"days":case"d":n=Math.round(86400*r);break;case"week":case"weeks":case"w":n=Math.round(604800*r);break;default:n=Math.round(31557600*r)}return"-"===t[1]||"ago"===t[4]?-n:n},Ze=e=>e.toLowerCase().replace(/^application\//,""),et=(e,t,r={})=>{let n;try{n=JSON.parse(l.decode(t))}catch{}if(!X(n))throw new O("JWT Claims Set must be a top-level JSON object");const{typ:i}=r;if(i&&("string"!=typeof e.typ||Ze(e.typ)!==Ze(i)))throw new E('unexpected "typ" JWT header value',n,"typ","check_failed");const{requiredClaims:s=[],issuer:a,subject:o,audience:c,maxTokenAge:u}=r,d=[...s];void 0!==u&&d.push("iat"),void 0!==c&&d.push("aud"),void 0!==o&&d.push("sub"),void 0!==a&&d.push("iss");for(const e of new Set(d.reverse()))if(!(e in n))throw new E(`missing required "${e}" claim`,n,e,"missing");if(a&&!(Array.isArray(a)?a:[a]).includes(n.iss))throw new E('unexpected "iss" claim value',n,"iss","check_failed");if(o&&n.sub!==o)throw new E('unexpected "sub" claim value',n,"sub","check_failed");if(c&&(p="string"==typeof c?[c]:c,!("string"==typeof(h=n.aud)?p.includes(h):Array.isArray(h)&&p.some(Set.prototype.has.bind(new Set(h))))))throw new E('unexpected "aud" claim value',n,"aud","check_failed");var h,p;let f;switch(typeof r.clockTolerance){case"string":f=Ye(r.clockTolerance);break;case"number":f=r.clockTolerance;break;case"undefined":f=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:y}=r,m=Ge(y||new Date);if((void 0!==n.iat||u)&&"number"!=typeof n.iat)throw new E('"iat" claim must be a number',n,"iat","invalid");if(void 0!==n.nbf){if("number"!=typeof n.nbf)throw new E('"nbf" claim must be a number',n,"nbf","invalid");if(n.nbf>m+f)throw new E('"nbf" claim timestamp check failed',n,"nbf","check_failed")}if(void 0!==n.exp){if("number"!=typeof n.exp)throw new E('"exp" claim must be a number',n,"exp","invalid");if(n.exp<=m-f)throw new v('"exp" claim timestamp check failed',n,"exp","check_failed")}if(u){const e=m-n.iat;if(e-f>("number"==typeof u?u:Ye(u)))throw new v('"iat" claim timestamp check failed (too far in the past)',n,"iat","check_failed");if(e<0-f)throw new E('"iat" claim timestamp check failed (it should be in the past)',n,"iat","check_failed")}return n};async function tt(e,t,r){const n=await ze(e,t,r);if(n.protectedHeader.crit?.includes("b64")&&!1===n.protectedHeader.b64)throw new O("JWTs MUST NOT use unencoded payload");const i={payload:et(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return"function"==typeof t?{...i,key:n.key}:i}async function rt(e,t,r){const n=await He(e,t,r),i=et(n.protectedHeader,n.plaintext,r),{protectedHeader:s}=n;if(void 0!==s.iss&&s.iss!==i.iss)throw new E('replicated "iss" claim header parameter mismatch',i,"iss","mismatch");if(void 0!==s.sub&&s.sub!==i.sub)throw new E('replicated "sub" claim header parameter mismatch',i,"sub","mismatch");if(void 0!==s.aud&&JSON.stringify(s.aud)!==JSON.stringify(i.aud))throw new E('replicated "aud" claim header parameter mismatch',i,"aud","mismatch");const a={payload:i,protectedHeader:s};return"function"==typeof t?{...a,key:n.key}:a}class nt{constructor(e){this._flattened=new Ue(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,t){const r=await this._flattened.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}class it{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){if(!this._protectedHeader&&!this._unprotectedHeader)throw new T("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!G(this._protectedHeader,this._unprotectedHeader))throw new T("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const r={...this._protectedHeader,...this._unprotectedHeader};let n=!0;if(ke(T,new Map([["b64",!0]]),t?.crit,this._protectedHeader,r).has("b64")&&(n=this._protectedHeader.b64,"boolean"!=typeof n))throw new T('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:i}=r;if("string"!=typeof i||!i)throw new T('JWS "alg" (Algorithm) Header Parameter missing or invalid');Te(i,e,"sign");let a,o=this._payload;n&&(o=c.encode(g(o))),a=this._protectedHeader?c.encode(g(JSON.stringify(this._protectedHeader))):c.encode("");const u=d(a,c.encode("."),o),h=await(async(e,t,r)=>{const n=await qe(e,t,"sign");oe(e,n);const i=await s.subtle.sign(Me(e,n.algorithm),n,r);return new Uint8Array(i)})(i,e,u),p={signature:g(h),payload:""};return n&&(p.payload=l.decode(o)),this._unprotectedHeader&&(p.header=this._unprotectedHeader),this._protectedHeader&&(p.protected=l.decode(a)),p}}class st{constructor(e){this._flattened=new it(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){const r=await this._flattened.sign(e,t);if(void 0===r.payload)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}class at{constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setProtectedHeader(e){if(this.protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this.protectedHeader=e,this}setUnprotectedHeader(e){if(this.unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addSignature(...e){return this.parent.addSignature(...e)}sign(...e){return this.parent.sign(...e)}done(){return this.parent}}class ot{constructor(e){this._signatures=[],this._payload=e}addSignature(e,t){const r=new at(this,e,t);return this._signatures.push(r),r}async sign(){if(!this._signatures.length)throw new T("at least one signature must be added");const e={signatures:[],payload:""};for(let t=0;t<this._signatures.length;t++){const r=this._signatures[t],n=new it(this._payload);n.setProtectedHeader(r.protectedHeader),n.setUnprotectedHeader(r.unprotectedHeader);const{payload:i,...s}=await n.sign(r.key,r.options);if(0===t)e.payload=i;else if(e.payload!==i)throw new T("inconsistent use of JWS Unencoded Payload (RFC7797)");e.signatures.push(s)}return e}}function ct(e,t){if(!Number.isFinite(t))throw new TypeError(`Invalid ${e} input`);return t}class lt{constructor(e={}){if(!X(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:ct("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:ct("setNotBefore",Ge(e))}:this._payload={...this._payload,nbf:Ge(new Date)+Ye(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:ct("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:ct("setExpirationTime",Ge(e))}:this._payload={...this._payload,exp:Ge(new Date)+Ye(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:Ge(new Date)}:e instanceof Date?this._payload={...this._payload,iat:ct("setIssuedAt",Ge(e))}:this._payload="string"==typeof e?{...this._payload,iat:ct("setIssuedAt",Ge(new Date)+Ye(e))}:{...this._payload,iat:ct("setIssuedAt",e)},this}}class ut extends lt{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){const r=new st(c.encode(JSON.stringify(this._payload)));if(r.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new O("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}class dt extends lt{setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,t){const r=new nt(c.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),r.setProtectedHeader(this._protectedHeader),this._iv&&r.setInitializationVector(this._iv),this._cek&&r.setContentEncryptionKey(this._cek),this._keyManagementParameters&&r.setKeyManagementParameters(this._keyManagementParameters),r.encrypt(e,t)}}const ht=(e,t)=>{if("string"!=typeof e||!e)throw new x(`${t} missing or invalid`)};async function pt(e,t){if(!X(e))throw new TypeError("JWK must be an object");if(t??(t="sha256"),"sha256"!==t&&"sha384"!==t&&"sha512"!==t)throw new TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');let r;switch(e.kty){case"EC":ht(e.crv,'"crv" (Curve) Parameter'),ht(e.x,'"x" (X Coordinate) Parameter'),ht(e.y,'"y" (Y Coordinate) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":ht(e.crv,'"crv" (Subtype of Key Pair) Parameter'),ht(e.x,'"x" (Public Key) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":ht(e.e,'"e" (Exponent) Parameter'),ht(e.n,'"n" (Modulus) Parameter'),r={e:e.e,kty:e.kty,n:e.n};break;case"oct":ht(e.k,'"k" (Key Value) Parameter'),r={k:e.k,kty:e.kty};break;default:throw new _('"kty" (Key Type) Parameter missing or unsupported')}const n=c.encode(JSON.stringify(r));return g(await o(t,n))}async function ft(e,t){t??(t="sha256");const r=await pt(e,t);return`urn:ietf:params:oauth:jwk-thumbprint:sha-${t.slice(-3)}:${r}`}async function yt(e,t){const r={...e,...t?.header};if(!X(r.jwk))throw new T('"jwk" (JSON Web Key) Header Parameter must be a JSON object');const n=await Pe({...r.jwk,ext:!0},r.alg);if(n instanceof Uint8Array||"public"!==n.type)throw new T('"jwk" (JSON Web Key) Header Parameter must be a public key');return n}function mt(e){return X(e)}function gt(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}class wt{constructor(e){if(this._cached=new WeakMap,!function(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(mt)}(e))throw new k("JSON Web Key Set malformed");this._jwks=gt(e)}async getKey(e,t){const{alg:r,kid:n}={...e,...t?.header},i=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new _('Unsupported "alg" value for a JSON Web Key Set')}}(r),s=this._jwks.keys.filter((e=>{let t=i===e.kty;if(t&&"string"==typeof n&&(t=n===e.kid),t&&"string"==typeof e.alg&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t&&"EdDSA"===r&&(t="Ed25519"===e.crv||"Ed448"===e.crv),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv}return t})),{0:a,length:o}=s;if(0===o)throw new R;if(1!==o){const e=new N,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(const e of s)try{yield await bt(t,e,r)}catch{}},e}return bt(this._cached,a,r)}}async function bt(e,t,r){const n=e.get(t)||e.set(t,{}).get(t);if(void 0===n[r]){const e=await Pe({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new k("JSON Web Key Set members must be public keys");n[r]=e}return n[r]}function St(e){const t=new wt(e),r=async(e,r)=>t.getKey(e,r);return Object.defineProperties(r,{jwks:{value:()=>gt(t._jwks),enumerable:!0,configurable:!1,writable:!1}}),r}let Et;"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(Et="jose/v5.4.1");class vt{constructor(e,t){if(!(e instanceof URL))throw new TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:t?.agent,headers:t?.headers},this._timeoutDuration="number"==typeof t?.timeoutDuration?t?.timeoutDuration:5e3,this._cooldownDuration="number"==typeof t?.cooldownDuration?t?.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof t?.cacheMaxAge?t?.cacheMaxAge:6e5}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(e,t){this._local&&this.fresh()||await this.reload();try{return await this._local(e,t)}catch(r){if(r instanceof R&&!1===this.coolingDown())return await this.reload(),this._local(e,t);throw r}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0);const e=new Headers(this._options.headers);Et&&!e.has("User-Agent")&&(e.set("User-Agent",Et),this._options.headers=Object.fromEntries(e.entries())),this._pendingFetch||(this._pendingFetch=(async(e,t,r)=>{let n,i,s=!1;"function"==typeof AbortController&&(n=new AbortController,i=setTimeout((()=>{s=!0,n.abort()}),t));const a=await fetch(e.href,{signal:n?n.signal:void 0,redirect:"manual",headers:r.headers}).catch((e=>{if(s)throw new H;throw e}));if(void 0!==i&&clearTimeout(i),200!==a.status)throw new S("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await a.json()}catch{throw new S("Failed to parse the JSON Web Key Set HTTP response as JSON")}})(this._url,this._timeoutDuration,this._options).then((e=>{this._local=St(e),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0})).catch((e=>{throw this._pendingFetch=void 0,e}))),await this._pendingFetch}}function At(e,t){const r=new vt(e,t),n=async(e,t)=>r.getKey(e,t);return Object.defineProperties(n,{coolingDown:{get:()=>r.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>r.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>r.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!r._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>r._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),n}class _t extends lt{encode(){return`${g(JSON.stringify({alg:"none"}))}.${g(JSON.stringify(this._payload))}.`}static decode(e,t){if("string"!=typeof e)throw new O("Unsecured JWT must be a string");const{0:r,1:n,2:i,length:s}=e.split(".");if(3!==s||""!==i)throw new O("Invalid Unsecured JWT");let a;try{if(a=JSON.parse(l.decode(b(r))),"none"!==a.alg)throw new Error}catch{throw new O("Invalid Unsecured JWT")}return{payload:et(a,b(n),t),header:a}}}const Ct=g,Pt=b;function Tt(e){let t;if("string"==typeof e){const r=e.split(".");3!==r.length&&5!==r.length||([t]=r)}else if("object"==typeof e&&e){if(!("protected"in e))throw new TypeError("Token does not contain a Protected Header");t=e.protected}try{if("string"!=typeof t||!t)throw new Error;const e=JSON.parse(l.decode(Pt(t)));if(!X(e))throw new Error;return e}catch{throw new TypeError("Invalid Token or Protected Header formatting")}}function Ot(e){if("string"!=typeof e)throw new O("JWTs must use Compact JWS serialization, JWT must be a string");const{1:t,length:r}=e.split(".");if(5===r)throw new O("Only JWTs using Compact JWS serialization can be decoded");if(3!==r)throw new O("Invalid JWT");if(!t)throw new O("JWTs must contain a payload");let n,i;try{n=Pt(t)}catch{throw new O("Failed to base64url decode the payload")}try{i=JSON.parse(l.decode(n))}catch{throw new O("Failed to parse the decoded payload as JSON")}if(!X(i))throw new O("Invalid JWT Claims Set");return i}function xt(e){const t=e?.modulusLength??2048;if("number"!=typeof t||t<2048)throw new _("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return t}async function kt(e,t){return async function(e,t){let r,n;switch(e){case"PS256":case"PS384":case"PS512":r={name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:xt(t)},n=["sign","verify"];break;case"RS256":case"RS384":case"RS512":r={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:xt(t)},n=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":r={name:"RSA-OAEP",hash:`SHA-${parseInt(e.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:xt(t)},n=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":r={name:"ECDSA",namedCurve:"P-256"},n=["sign","verify"];break;case"ES384":r={name:"ECDSA",namedCurve:"P-384"},n=["sign","verify"];break;case"ES512":r={name:"ECDSA",namedCurve:"P-521"},n=["sign","verify"];break;case"EdDSA":{n=["sign","verify"];const e=t?.crv??"Ed25519";switch(e){case"Ed25519":case"Ed448":r={name:e};break;default:throw new _("Invalid or unsupported crv option provided")}break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{n=["deriveKey","deriveBits"];const e=t?.crv??"P-256";switch(e){case"P-256":case"P-384":case"P-521":r={name:"ECDH",namedCurve:e};break;case"X25519":case"X448":r={name:e};break;default:throw new _("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new _('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return s.subtle.generateKey(r,t?.extractable??!1,n)}(e,t)}async function Rt(e,t){return async function(e,t){let r,n,i;switch(e){case"HS256":case"HS384":case"HS512":r=parseInt(e.slice(-3),10),n={name:"HMAC",hash:`SHA-${r}`,length:r},i=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r=parseInt(e.slice(-3),10),K(new Uint8Array(r>>3));case"A128KW":case"A192KW":case"A256KW":r=parseInt(e.slice(1,4),10),n={name:"AES-KW",length:r},i=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":r=parseInt(e.slice(1,4),10),n={name:"AES-GCM",length:r},i=["encrypt","decrypt"];break;default:throw new _('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return s.subtle.generateKey(n,t?.extractable??!1,i)}(e,t)}const Nt="WebCryptoAPI"},706:e=>{e.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{r.d(n,{c:()=>qt});const e=Symbol.for("drizzle:entityKind");function t(t,r){if(!t||"object"!=typeof t)return!1;if(t instanceof r)return!0;if(!Object.prototype.hasOwnProperty.call(r,e))throw new Error(`Class "${r.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let n=t.constructor;if(n)for(;n;){if(e in n&&n[e]===r[e])return!0;n=Object.getPrototypeOf(n)}return!1}Symbol.for("drizzle:hasOwnEntityKind");class i{static[e]="ConsoleLogWriter";write(e){console.log(e)}}class s{static[e]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new i}logQuery(e,t){const r=t.map((e=>{try{return JSON.stringify(e)}catch{return String(e)}})),n=r.length?` -- params: [${r.join(", ")}]`:"";this.writer.write(`Query: ${e}${n}`)}}class a{static[e]="NoopLogger";logQuery(){}}const o=Symbol.for("drizzle:Name"),c=Symbol.for("drizzle:Schema"),l=Symbol.for("drizzle:Columns"),u=Symbol.for("drizzle:OriginalName"),d=Symbol.for("drizzle:BaseName"),h=Symbol.for("drizzle:IsAlias"),p=Symbol.for("drizzle:ExtraConfigBuilder"),f=Symbol.for("drizzle:IsDrizzleTable");class y{static[e]="Table";static Symbol={Name:o,Schema:c,OriginalName:u,Columns:l,BaseName:d,IsAlias:h,ExtraConfigBuilder:p};[o];[u];[c];[l];[d];[h]=!1;[p]=void 0;[f]=!0;constructor(e,t,r){this[o]=this[u]=e,this[c]=t,this[d]=r}}function m(e){return e[o]}class g{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType}static[e]="Column";name;primary;notNull;default;defaultFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}}const w=Symbol.for("drizzle:PgInlineForeignKeys");class b extends y{static[e]="PgTable";static Symbol=Object.assign({},y.Symbol,{InlineForeignKeys:w});[w]=[];[y.Symbol.ExtraConfigBuilder]=void 0}class S{static[e]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new E(e,this.columns,this.name)}}class E{constructor(e,t,r){this.table=e,this.columns=t,this.name=r}static[e]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[b.Symbol.Name]}_${this.columns.map((e=>e.name)).join("_")}_pk`}}const v=Symbol.for("drizzle:SubqueryConfig");class A{static[e]="Subquery";[v];constructor(e,t,r,n=!1){this[v]={sql:e,selection:t,alias:r,isWith:n}}}class _ extends A{static[e]="WithSubquery"}const C=(e,t)=>t(),P=Symbol.for("drizzle:ViewBaseConfig");function T(e){return"object"==typeof e&&null!==e&&"getSQL"in e&&"function"==typeof e.getSQL}class O{static[e]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new x([this])}}class x{constructor(e){this.queryChunks=e}static[e]="SQL";decoder=R;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return C("drizzle.buildSQL",(t=>{const r=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":r.sql,"drizzle.query.params":JSON.stringify(r.params)}),r}))}buildQueryFromSourceParams(e,r){const n=Object.assign({},r,{inlineParams:r.inlineParams||this.shouldInlineParams,paramStartIndex:r.paramStartIndex||{value:0}}),{escapeName:i,escapeParam:s,prepareTyping:a,inlineParams:o,paramStartIndex:c}=n;return function(e){const t={sql:"",params:[]};for(const r of e)t.sql+=r.sql,t.params.push(...r.params),r.typings?.length&&(t.typings||(t.typings=[]),t.typings.push(...r.typings));return t}(e.map((e=>{if(t(e,O))return{sql:e.value.join(""),params:[]};if(t(e,k))return{sql:i(e.value),params:[]};if(void 0===e)return{sql:"",params:[]};if(Array.isArray(e)){const t=[new O("(")];for(const[r,n]of e.entries())t.push(n),r<e.length-1&&t.push(new O(", "));return t.push(new O(")")),this.buildQueryFromSourceParams(t,n)}if(t(e,x))return this.buildQueryFromSourceParams(e.queryChunks,{...n,inlineParams:o||e.shouldInlineParams});if(t(e,y)){const t=e[y.Symbol.Schema],r=e[y.Symbol.Name];return{sql:void 0===t?i(r):i(t)+"."+i(r),params:[]}}if(t(e,g))return{sql:i(e.table[y.Symbol.Name])+"."+i(e.name),params:[]};if(t(e,I)){const t=e[P].schema,r=e[P].name;return{sql:void 0===t?i(r):i(t)+"."+i(r),params:[]}}if(t(e,H)){const r=null===e.value?null:e.encoder.mapToDriverValue(e.value);if(t(r,x))return this.buildQueryFromSourceParams([r],n);if(o)return{sql:this.mapInlineParam(r,n),params:[]};let i;return void 0!==a&&(i=[a(e.encoder)]),{sql:s(c.value++,r),params:[r],typings:i}}return t(e,$)?{sql:s(c.value++,e),params:[e]}:t(e,x.Aliased)&&void 0!==e.fieldAlias?{sql:i(e.fieldAlias),params:[]}:t(e,A)?e[v].isWith?{sql:i(e[v].alias),params:[]}:this.buildQueryFromSourceParams([new O("("),e[v].sql,new O(") "),new k(e[v].alias)],n):T(e)?this.buildQueryFromSourceParams([new O("("),e.getSQL(),new O(")")],n):t(e,le)?this.buildQueryFromSourceParams([e.sourceTable,new O("."),j.identifier(e.fieldName)],n):o?{sql:this.mapInlineParam(e,n),params:[]}:{sql:s(c.value++,e),params:[e]}})))}mapInlineParam(e,{escapeString:t}){if(null===e)return"null";if("number"==typeof e||"boolean"==typeof e)return e.toString();if("string"==typeof e)return t(e);if("object"==typeof e){const r=e.toString();return t("[object Object]"===r?JSON.stringify(e):r)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return void 0===e?this:new x.Aliased(this,e)}mapWith(e){return this.decoder="function"==typeof e?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}}class k{constructor(e){this.value=e}static[e]="Name";brand;getSQL(){return new x([this])}}const R={mapFromDriverValue:e=>e},N={mapToDriverValue:e=>e};class H{constructor(e,t=N){this.value=e,this.encoder=t}static[e]="Param";brand;getSQL(){return new x([this])}}function j(e,...t){const r=[];(t.length>0||e.length>0&&""!==e[0])&&r.push(new O(e[0]));for(const[n,i]of t.entries())r.push(i,new O(e[n+1]));return new x(r)}var K;(K=j||(j={})).empty=function(){return new x([])},K.fromList=function(e){return new x(e)},K.raw=function(e){return new x([new O(e)])},K.join=function(e,t){const r=[];for(const[n,i]of e.entries())n>0&&void 0!==t&&r.push(t),r.push(i);return new x(r)},K.identifier=function(e){return new k(e)},K.placeholder=function(e){return new $(e)},K.param=function(e,t){return new H(e,t)},(t=>{class r{constructor(e,t){this.sql=e,this.fieldAlias=t}static[e]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new r(this.sql,this.fieldAlias)}}t.Aliased=r})(x||(x={}));class ${constructor(e){this.name=e}static[e]="Placeholder";getSQL(){return new x([this])}}function D(e,r){return e.map((e=>{if(t(e,$)){if(!(e.name in r))throw new Error(`No value for placeholder "${e.name}" was provided`);return r[e.name]}return e}))}class I{static[e]="View";[P];constructor({name:e,schema:t,selectedFields:r,query:n}){this[P]={name:e,originalName:e,schema:t,selectedFields:r,query:n,isExisting:!n,isAlias:!1}}getSQL(){return new x([this])}}function J(e,r){return!function(e){return"object"==typeof e&&null!==e&&"mapToDriverValue"in e&&"function"==typeof e.mapToDriverValue}(r)||T(e)||t(e,H)||t(e,$)||t(e,g)||t(e,y)||t(e,I)?e:new H(e,r)}g.prototype.getSQL=function(){return new x([this])},y.prototype.getSQL=function(){return new x([this])},A.prototype.getSQL=function(){return new x([this])};const W=(e,t)=>j`${e} = ${J(t,e)}`,U=(e,t)=>j`${e} <> ${J(t,e)}`;function L(...e){const t=e.filter((e=>void 0!==e));if(0!==t.length)return 1===t.length?new x(t):new x([new O("("),j.join(t,new O(" and ")),new O(")")])}function B(...e){const t=e.filter((e=>void 0!==e));if(0!==t.length)return 1===t.length?new x(t):new x([new O("("),j.join(t,new O(" or ")),new O(")")])}function M(e){return j`not ${e}`}const q=(e,t)=>j`${e} > ${J(t,e)}`,Q=(e,t)=>j`${e} >= ${J(t,e)}`,F=(e,t)=>j`${e} < ${J(t,e)}`,z=(e,t)=>j`${e} <= ${J(t,e)}`;function V(e,t){if(Array.isArray(t)){if(0===t.length)throw new Error("inArray requires at least one value");return j`${e} in ${t.map((t=>J(t,e)))}`}return j`${e} in ${J(t,e)}`}function G(e,t){if(Array.isArray(t)){if(0===t.length)throw new Error("notInArray requires at least one value");return j`${e} not in ${t.map((t=>J(t,e)))}`}return j`${e} not in ${J(t,e)}`}function X(e){return j`${e} is null`}function Y(e){return j`${e} is not null`}function Z(e){return j`exists ${e}`}function ee(e){return j`not exists ${e}`}function te(e,t,r){return j`${e} between ${J(t,e)} and ${J(r,e)}`}function re(e,t,r){return j`${e} not between ${J(t,e)} and ${J(r,e)}`}function ne(e,t){return j`${e} like ${t}`}function ie(e,t){return j`${e} not like ${t}`}function se(e,t){return j`${e} ilike ${t}`}function ae(e,t){return j`${e} not ilike ${t}`}function oe(e){return j`${e} asc`}function ce(e){return j`${e} desc`}class le{constructor(e,t,r){this.sourceTable=e,this.referencedTable=t,this.relationName=r,this.referencedTableName=t[y.Symbol.Name]}static[e]="Relation";referencedTableName;fieldName}class ue{constructor(e,t){this.table=e,this.config=t}static[e]="Relations"}class de extends le{constructor(e,t,r,n){super(e,t,r?.relationName),this.config=r,this.isNullable=n}static[e]="One";withFieldName(e){const t=new de(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}}class he extends le{constructor(e,t,r){super(e,t,r?.relationName),this.config=r}static[e]="Many";withFieldName(e){const t=new he(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}}function pe(e){return function(t,r){return new de(e,t,r,r?.fields.reduce(((e,t)=>e&&t.notNull),!0)??!1)}}function fe(e){return function(t,r){return new he(e,t,r)}}function ye(e,r,n){if(t(n,de)&&n.config)return{fields:n.config.fields,references:n.config.references};const i=r[n.referencedTable[y.Symbol.Name]];if(!i)throw new Error(`Table "${n.referencedTable[y.Symbol.Name]}" not found in schema`);const s=e[i];if(!s)throw new Error(`Table "${i}" not found in schema`);const a=n.sourceTable,o=r[a[y.Symbol.Name]];if(!o)throw new Error(`Table "${a[y.Symbol.Name]}" not found in schema`);const c=[];for(const e of Object.values(s.relations))(n.relationName&&n!==e&&e.relationName===n.relationName||!n.relationName&&e.referencedTable===n.sourceTable)&&c.push(e);if(c.length>1)throw n.relationName?new Error(`There are multiple relations with name "${n.relationName}" in table "${i}"`):new Error(`There are multiple relations between "${i}" and "${n.sourceTable[y.Symbol.Name]}". Please specify relation name`);if(c[0]&&t(c[0],de)&&c[0].config)return{fields:c[0].config.references,references:c[0].config.fields};throw new Error(`There is not enough information to infer relation "${o}.${n.fieldName}"`)}function me(e){return{one:pe(e),many:fe(e)}}function ge(e,r,n,i,s=(e=>e)){const a={};for(const[o,c]of i.entries())if(c.isJson){const i=r.relations[c.tsKey],l=n[o],u="string"==typeof l?JSON.parse(l):l;a[c.tsKey]=t(i,de)?u&&ge(e,e[c.relationTableTsKey],u,c.selection,s):u.map((t=>ge(e,e[c.relationTableTsKey],t,c.selection,s)))}else{const e=s(n[o]),r=c.field;let i;i=t(r,g)?r:t(r,x)?r.decoder:r.sql.decoder,a[c.tsKey]=null===e?null:i.mapFromDriverValue(e)}return a}class we{constructor(e){this.table=e}static[e]="ColumnAliasProxyHandler";get(e,t){return"table"===t?this.table:e[t]}}class be{constructor(e,t){this.alias=e,this.replaceOriginalName=t}static[e]="TableAliasProxyHandler";get(e,r){if(r===y.Symbol.IsAlias)return!0;if(r===y.Symbol.Name)return this.alias;if(this.replaceOriginalName&&r===y.Symbol.OriginalName)return this.alias;if(r===P)return{...e[P],name:this.alias,isAlias:!0};if(r===y.Symbol.Columns){const t=e[y.Symbol.Columns];if(!t)return t;const r={};return Object.keys(t).map((n=>{r[n]=new Proxy(t[n],new we(new Proxy(e,this)))})),r}const n=e[r];return t(n,g)?new Proxy(n,new we(new Proxy(e,this))):n}}function Se(e,t){return new Proxy(e,new be(t,!1))}function Ee(e,t){return new Proxy(e,new we(new Proxy(e.table,new be(t,!1))))}function ve(e,t){return new x.Aliased(Ae(e.sql,t),e.fieldAlias)}function Ae(e,r){return j.join(e.queryChunks.map((e=>t(e,g)?Ee(e,r):t(e,x)?Ae(e,r):t(e,x.Aliased)?ve(e,r):e)))}class _e{static[e]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,r){if(r===v)return{...e[v],selection:new Proxy(e[v].selection,this)};if(r===P)return{...e[P],selectedFields:new Proxy(e[P].selectedFields,this)};if("symbol"==typeof r)return e[r];const n=(t(e,A)?e[v].selection:t(e,I)?e[P].selectedFields:e)[r];if(t(n,x.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!n.isSelectionField)return n.sql;const e=n.clone();return e.isSelectionField=!0,e}if(t(n,x)){if("sql"===this.config.sqlBehavior)return n;throw new Error(`You tried to reference "${r}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return t(n,g)?this.config.alias?new Proxy(n,new we(new Proxy(n.table,new be(this.config.alias,this.config.replaceOriginalName??!1)))):n:"object"!=typeof n||null===n?n:new Proxy(n,new _e(this.config))}}class Ce extends Error{static[e]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}}class Pe extends Ce{static[e]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}const Te=Symbol.for("drizzle:SQLiteInlineForeignKeys");class Oe extends y{static[e]="SQLiteTable";static Symbol=Object.assign({},y.Symbol,{InlineForeignKeys:Te});[y.Symbol.Columns];[Te]=[];[y.Symbol.ExtraConfigBuilder]=void 0}class xe extends g{constructor(e,t){t.uniqueName||(t.uniqueName=function(e,t){return`${e[Oe.Symbol.Name]}_${t.join("_")}_unique`}(e,[t.name])),super(e,t),this.table=e}static[e]="SQLiteColumn"}function ke(e,r,n){const i={},s=e.reduce(((e,{path:s,field:a},o)=>{let c;c=t(a,g)?a:t(a,x)?a.decoder:a.sql.decoder;let l=e;for(const[e,u]of s.entries())if(e<s.length-1)u in l||(l[u]={}),l=l[u];else{const e=r[o],d=l[u]=null===e?null:c.mapFromDriverValue(e);if(n&&t(a,g)&&2===s.length){const e=s[0];e in i?"string"==typeof i[e]&&i[e]!==m(a.table)&&(i[e]=!1):i[e]=null===d&&m(a.table)}}return e}),{});if(n&&Object.keys(i).length>0)for(const[e,t]of Object.entries(i))"string"!=typeof t||n[t]||(s[e]=null);return s}function Re(e,r){return Object.entries(e).reduce(((e,[n,i])=>{if("string"!=typeof n)return e;const s=r?[...r,n]:[n];return t(i,g)||t(i,x)||t(i,x.Aliased)?e.push({path:s,field:i}):t(i,y)?e.push(...Re(i[y.Symbol.Columns],s)):e.push(...Re(i,s)),e}),[])}function Ne(e,t){const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(const[e,t]of r.entries())if(t!==n[e])return!1;return!0}function He(e,r){const n=Object.entries(r).filter((([,e])=>void 0!==e)).map((([r,n])=>t(n,x)?[r,n]:[r,new H(n,e[y.Symbol.Columns][r])]));if(0===n.length)throw new Error("No values to set");return Object.fromEntries(n)}function je(e){return t(e,A)?e[v].alias:t(e,I)?e[P].name:t(e,x)?void 0:e[y.Symbol.IsAlias]?e[y.Symbol.Name]:e[y.Symbol.BaseName]}class Ke extends I{static[e]="SQLiteViewBase"}class $e{static[e]="SQLiteDialect";escapeName(e){return`"${e}"`}escapeParam(e){return"?"}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildDeleteQuery({table:e,where:t,returning:r}){return j`delete from ${e}${t?j` where ${t}`:void 0}${r?j` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0}`}buildUpdateSet(e,t){const r=Object.entries(t),n=r.length;return j.join(r.flatMap((([t,r],i)=>{const s=e[y.Symbol.Columns][t],a=j`${j.identifier(s.name)} = ${r}`;return i<n-1?[a,j.raw(", ")]:[a]})))}buildUpdateQuery({table:e,set:t,where:r,returning:n}){return j`update ${e} set ${this.buildUpdateSet(e,t)}${r?j` where ${r}`:void 0}${n?j` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0}`}buildSelection(e,{isSingleTable:r=!1}={}){const n=e.length,i=e.flatMap((({field:e},i)=>{const s=[];if(t(e,x.Aliased)&&e.isSelectionField)s.push(j.identifier(e.fieldAlias));else if(t(e,x.Aliased)||t(e,x)){const n=t(e,x.Aliased)?e.sql:e;r?s.push(new x(n.queryChunks.map((e=>t(e,g)?j.identifier(e.name):e)))):s.push(n),t(e,x.Aliased)&&s.push(j` as ${j.identifier(e.fieldAlias)}`)}else if(t(e,g)){const t=e.table[y.Symbol.Name],n=e.name;r?s.push(j.identifier(n)):s.push(j`${j.identifier(t)}.${j.identifier(n)}`)}return i<n-1&&s.push(j`, `),s}));return j.join(i)}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:s,table:a,joins:o,orderBy:c,groupBy:l,limit:u,offset:d,distinct:h,setOperators:p}){const f=n??Re(r);for(const e of f)if(t(e.field,g)&&m(e.field.table)!==(t(a,A)?a[v].alias:t(a,Ke)?a[P].name:t(a,x)?void 0:m(a))&&!(e=>o?.some((({alias:t})=>t===(e[y.Symbol.IsAlias]?m(e):e[y.Symbol.BaseName]))))(e.field.table)){const t=m(e.field.table);throw new Error(`Your "${e.path.join("->")}" field references a column "${t}"."${e.field.name}", but the table "${t}" is not part of the query! Did you forget to join it?`)}const w=!o||0===o.length;let b;if(e?.length){const t=[j`with `];for(const[r,n]of e.entries())t.push(j`${j.identifier(n[v].alias)} as (${n[v].sql})`),r<e.length-1&&t.push(j`, `);t.push(j` `),b=j.join(t)}const S=h?j` distinct`:void 0,E=this.buildSelection(f,{isSingleTable:w}),_=t(a,y)&&a[y.Symbol.OriginalName]!==a[y.Symbol.Name]?j`${j.identifier(a[y.Symbol.OriginalName])} ${j.identifier(a[y.Symbol.Name])}`:a,C=[];if(o)for(const[e,r]of o.entries()){0===e&&C.push(j` `);const n=r.table;if(t(n,Oe)){const e=n[Oe.Symbol.Name],t=n[Oe.Symbol.Schema],i=n[Oe.Symbol.OriginalName],s=e===i?void 0:r.alias;C.push(j`${j.raw(r.joinType)} join ${t?j`${j.identifier(t)}.`:void 0}${j.identifier(i)}${s&&j` ${j.identifier(s)}`} on ${r.on}`)}else C.push(j`${j.raw(r.joinType)} join ${n} on ${r.on}`);e<o.length-1&&C.push(j` `)}const T=j.join(C),O=i?j` where ${i}`:void 0,k=s?j` having ${s}`:void 0,R=[];if(c)for(const[e,t]of c.entries())R.push(t),e<c.length-1&&R.push(j`, `);const N=[];if(l)for(const[e,t]of l.entries())N.push(t),e<l.length-1&&N.push(j`, `);const H=N.length>0?j` group by ${j.join(N)}`:void 0,K=R.length>0?j` order by ${j.join(R)}`:void 0,$=j`${b}select${S} ${E} from ${_}${T}${O}${H}${k}${K}${u?j` limit ${u}`:void 0}${d?j` offset ${d}`:void 0}`;return p.length>0?this.buildSetOperations($,p):$}buildSetOperations(e,t){const[r,...n]=t;if(!r)throw new Error("Cannot pass undefined values to any set operator");return 0===n.length?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),n)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:s,orderBy:a,offset:o}}){const c=j`${e.getSQL()} `,l=j`${i.getSQL()}`;let u;if(a&&a.length>0){const e=[];for(const r of a)if(t(r,xe))e.push(j.identifier(r.name));else if(t(r,x)){for(let e=0;e<r.queryChunks.length;e++){const n=r.queryChunks[e];t(n,xe)&&(r.queryChunks[e]=j.identifier(n.name))}e.push(j`${r}`)}else e.push(j`${r}`);u=j` order by ${j.join(e,j`, `)}`}const d=s?j` limit ${s}`:void 0,h=j.raw(`${r} ${n?"all ":""}`);return j`${c}${h}${l}${u}${d}${o?j` offset ${o}`:void 0}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i}){const s=[],a=e[y.Symbol.Columns],o=Object.entries(a),c=o.map((([,e])=>j.identifier(e.name)));for(const[e,n]of r.entries()){const i=[];for(const[e,r]of o){const s=n[e];if(void 0===s||t(s,H)&&void 0===s.value){let e;if(null!==r.default&&void 0!==r.default)e=t(r.default,x)?r.default:j.param(r.default,r);else if(void 0!==r.defaultFn){const n=r.defaultFn();e=t(n,x)?n:j.param(n,r)}else e=j`null`;i.push(e)}else i.push(s)}s.push(i),e<r.length-1&&s.push(j`, `)}const l=j.join(s);return j`insert into ${e} ${c} values ${l}${n?j` on conflict ${n}`:void 0}${i?j` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0}`}sqlToQuery(e){return e.toQuery({escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString})}buildRelationalQuery({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:s,queryConfig:a,tableAlias:o,nestedQueryRelation:c,joinOn:l}){let u,d,h,p=[],f=[];const m=[];if(!0===a)p=Object.entries(s.columns).map((([e,t])=>({dbKey:t.name,tsKey:e,field:Ee(t,o),relationTableTsKey:void 0,isJson:!1,selection:[]})));else{const i=Object.fromEntries(Object.entries(s.columns).map((([e,t])=>[e,Ee(t,o)])));if(a.where){const e="function"==typeof a.where?a.where(i,{and:L,between:te,eq:W,exists:Z,gt:q,gte:Q,ilike:se,inArray:V,isNull:X,isNotNull:Y,like:ne,lt:F,lte:z,ne:U,not:M,notBetween:re,notExists:ee,notLike:ie,notIlike:ae,notInArray:G,or:B,sql:j}):a.where;h=e&&Ae(e,o)}const c=[];let l=[];if(a.columns){let e=!1;for(const[t,r]of Object.entries(a.columns))void 0!==r&&t in s.columns&&(e||!0!==r||(e=!0),l.push(t));l.length>0&&(l=e?l.filter((e=>!0===a.columns?.[e])):Object.keys(s.columns).filter((e=>!l.includes(e))))}else l=Object.keys(s.columns);for(const e of l){const t=s.columns[e];c.push({tsKey:e,value:t})}let m,w=[];if(a.with&&(w=Object.entries(a.with).filter((e=>!!e[1])).map((([e,t])=>({tsKey:e,queryConfig:t,relation:s.relations[e]})))),a.extras){m="function"==typeof a.extras?a.extras(i,{sql:j}):a.extras;for(const[e,t]of Object.entries(m))c.push({tsKey:e,value:ve(t,o)})}for(const{tsKey:e,value:r}of c)p.push({dbKey:t(r,x.Aliased)?r.fieldAlias:s.columns[e].name,tsKey:e,field:t(r,g)?Ee(r,o):r,relationTableTsKey:void 0,isJson:!1,selection:[]});let b="function"==typeof a.orderBy?a.orderBy(i,{sql:j,asc:oe,desc:ce}):a.orderBy??[];Array.isArray(b)||(b=[b]),f=b.map((e=>t(e,g)?Ee(e,o):Ae(e,o))),u=a.limit,d=a.offset;for(const{tsKey:i,queryConfig:s,relation:a}of w){const c=ye(r,n,a),l=n[a.referencedTable[y.Symbol.Name]],u=`${o}_${i}`,d=L(...c.fields.map(((e,t)=>W(Ee(c.references[t],u),Ee(e,o))))),h=this.buildRelationalQuery({fullSchema:e,schema:r,tableNamesMap:n,table:e[l],tableConfig:r[l],queryConfig:t(a,de)?!0===s?{limit:1}:{...s,limit:1}:s,tableAlias:u,joinOn:d,nestedQueryRelation:a}),f=j`(${h.sql})`.as(i);p.push({dbKey:i,tsKey:i,field:f,relationTableTsKey:l,isJson:!0,selection:h.selection})}}if(0===p.length)throw new Ce({message:`No fields selected for table "${s.tsName}" ("${o}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});let w;if(h=L(l,h),c){let e=j`json_array(${j.join(p.map((({field:e})=>t(e,xe)?j.identifier(e.name):t(e,x.Aliased)?e.sql:e)),j`, `)})`;t(c,he)&&(e=j`coalesce(json_group_array(${e}), json_array())`);const r=[{dbKey:"data",tsKey:"data",field:e.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:p}];void 0!==u||void 0!==d||f.length>0?(w=this.buildSelectQuery({table:Se(i,o),fields:{},fieldsFlat:[{path:[],field:j.raw("*")}],where:h,limit:u,offset:d,orderBy:f,setOperators:[]}),h=void 0,u=void 0,d=void 0,f=void 0):w=Se(i,o),w=this.buildSelectQuery({table:t(w,Oe)?w:new A(w,{},o),fields:{},fieldsFlat:r.map((({field:e})=>({path:[],field:t(e,g)?Ee(e,o):e}))),joins:m,where:h,limit:u,offset:d,orderBy:f,setOperators:[]})}else w=this.buildSelectQuery({table:Se(i,o),fields:{},fieldsFlat:p.map((({field:e})=>({path:[],field:t(e,g)?Ee(e,o):e}))),joins:m,where:h,limit:u,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:s.tsName,sql:w,selection:p}}}class De extends $e{static[e]="SQLiteSyncDialect";migrate(e,t){const r=j`
			CREATE TABLE IF NOT EXISTS "__drizzle_migrations" (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;t.run(r);const n=t.values(j`SELECT id, hash, created_at FROM "__drizzle_migrations" ORDER BY created_at DESC LIMIT 1`)[0]??void 0;t.run(j`BEGIN`);try{for(const r of e)if(!n||Number(n[2])<r.folderMillis){for(const e of r.sql)t.run(j.raw(e));t.run(j`INSERT INTO "__drizzle_migrations" ("hash", "created_at") VALUES(${r.hash}, ${r.folderMillis})`)}t.run(j`COMMIT`)}catch(e){throw t.run(j`ROLLBACK`),e}}}class Ie extends $e{static[e]="SQLiteAsyncDialect";async migrate(e,t){const r=j`
			CREATE TABLE IF NOT EXISTS "__drizzle_migrations" (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await t.run(r);const n=(await t.values(j`SELECT id, hash, created_at FROM "__drizzle_migrations" ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await t.transaction((async t=>{for(const r of e)if(!n||Number(n[2])<r.folderMillis){for(const e of r.sql)await t.run(j.raw(e));await t.run(j`INSERT INTO "__drizzle_migrations" ("hash", "created_at") VALUES(${r.hash}, ${r.folderMillis})`)}}))}}class Je{static[e]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class We{static[e]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then((t=>(e?.(),t)),(t=>{throw e?.(),t}))}then(e,t){return this.execute().then(e,t)}}class Ue{static[e]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,this.withList=e.withList,this.distinct=e.distinct}from(e){const r=!!this.fields;let n;return n=this.fields?this.fields:t(e,A)?Object.fromEntries(Object.keys(e[v].selection).map((t=>[t,e[t]]))):t(e,Ke)?e[P].selectedFields:t(e,x)?{}:e[y.Symbol.Columns],new Be({table:e,fields:n,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}class Le extends Je{static[e]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:t,isPartialSelect:r,session:n,dialect:i,withList:s,distinct:a}){super(),this.config={withList:s,table:e,fields:{...t},distinct:a,setOperators:[]},this.isPartialSelect=r,this.session=n,this.dialect=i,this._={selectedFields:t},this.tableName=je(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{const i=this.tableName,s=je(r);if("string"==typeof s&&this.config.joins?.some((e=>e.alias===s)))throw new Error(`Alias "${s}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof i&&(this.config.fields={[i]:this.config.fields}),"string"==typeof s&&!t(r,x))){const e=t(r,A)?r[v].selection:t(r,I)?r[P].selectedFields:r[y.Symbol.Columns];this.config.fields[s]=e}if("function"==typeof n&&(n=n(new Proxy(this.config.fields,new _e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:s}),"string"==typeof s)switch(e){case"left":this.joinsNotNullableMap[s]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map((([e])=>[e,!1]))),this.joinsNotNullableMap[s]=!0;break;case"inner":this.joinsNotNullableMap[s]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map((([e])=>[e,!1]))),this.joinsNotNullableMap[s]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,t){return r=>{const n="function"==typeof r?r(qe()):r;if(!Ne(this.getSelectedFields(),n.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:n}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new _e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new _e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if("function"==typeof e[0]){const t=e[0](new Proxy(this.config.fields,new _e({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if("function"==typeof e[0]){const t=e[0](new Proxy(this.config.fields,new _e({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else{const t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new A(this.getSQL(),this.config.fields,e),new _e({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new _e({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class Be extends Le{static[e]="SQLiteSelect";prepare(e){if(!this.session)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");const t=Re(this.config.fields),r=this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),t,"all");return r.joinsNotNullableMap=this.joinsNotNullableMap,r}run=e=>this.prepare(!0).run(e);all=e=>this.prepare(!0).all(e);get=e=>this.prepare(!0).get(e);values=e=>this.prepare(!0).values(e);async execute(){return this.all()}}function Me(e,t){return(r,n,...i)=>{const s=[n,...i].map((r=>({type:e,isAll:t,rightSelect:r})));for(const e of s)if(!Ne(r.getSelectedFields(),e.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(s)}}!function(e,t){for(const r of t)for(const t of Object.getOwnPropertyNames(r.prototype))"constructor"!==t&&Object.defineProperty(e.prototype,t,Object.getOwnPropertyDescriptor(r.prototype,t)||Object.create(null))}(Be,[We]);const qe=()=>({union:Qe,unionAll:Fe,intersect:ze,except:Ve}),Qe=Me("union",!1),Fe=Me("union",!0),ze=Me("intersect",!1),Ve=Me("except",!1);class Ge{static[e]="SQLiteQueryBuilder";dialect;$with(e){const t=this;return{as:r=>("function"==typeof r&&(r=r(t)),new Proxy(new _(r.getSQL(),r.getSelectedFields(),e,!0),new _e({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}}with(...e){const t=this;return{select:function(r){return new Ue({fields:r??void 0,session:void 0,dialect:t.getDialect(),withList:e})},selectDistinct:function(r){return new Ue({fields:r??void 0,session:void 0,dialect:t.getDialect(),withList:e,distinct:!0})}}}select(e){return new Ue({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new Ue({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){return this.dialect||(this.dialect=new De),this.dialect}}class Xe{constructor(e,t,r){this.table=e,this.session=t,this.dialect=r}static[e]="SQLiteUpdateBuilder";set(e){return new Ye(this.table,He(this.table,e),this.session,this.dialect)}}class Ye extends We{constructor(e,t,r,n){super(),this.session=r,this.dialect=n,this.config={set:t,table:e}}static[e]="SQLiteUpdate";config;where(e){return this.config.where=e,this}returning(e=this.config.table[Oe.Symbol.Columns]){return this.config.returning=Re(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}prepare(e){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run")}run=e=>this.prepare(!0).run(e);all=e=>this.prepare(!0).all(e);get=e=>this.prepare(!0).get(e);values=e=>this.prepare(!0).values(e);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class Ze{constructor(e,t,r){this.table=e,this.session=t,this.dialect=r}static[e]="SQLiteInsertBuilder";values(e){if(0===(e=Array.isArray(e)?e:[e]).length)throw new Error("values() must be called with at least one value");const r=e.map((e=>{const r={},n=this.table[y.Symbol.Columns];for(const i of Object.keys(e)){const s=e[i];r[i]=t(s,x)?s:new H(s,n[i])}return r}));return new et(this.table,r,this.session,this.dialect)}}class et extends We{constructor(e,t,r,n){super(),this.session=r,this.dialect=n,this.config={table:e,values:t}}static[e]="SQLiteInsert";config;returning(e=this.config.table[Oe.Symbol.Columns]){return this.config.returning=Re(e),this}onConflictDoNothing(e={}){if(void 0===e.target)this.config.onConflict=j`do nothing`;else{const t=Array.isArray(e.target)?j`${e.target}`:j`${[e.target]}`,r=e.where?j` where ${e.where}`:j``;this.config.onConflict=j`${t} do nothing${r}`}return this}onConflictDoUpdate(e){const t=Array.isArray(e.target)?j`${e.target}`:j`${[e.target]}`,r=e.where?j` where ${e.where}`:j``,n=this.dialect.buildUpdateSet(this.config.table,He(this.config.table,e.set));return this.config.onConflict=j`${t} do update set ${n}${r}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}prepare(e){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run")}run=e=>this.prepare(!0).run(e);all=e=>this.prepare(!0).all(e);get=e=>this.prepare(!0).get(e);values=e=>this.prepare(!0).values(e);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class tt extends We{constructor(e,t,r){super(),this.table=e,this.session=t,this.dialect=r,this.config={table:e}}static[e]="SQLiteDelete";config;where(e){return this.config.where=e,this}returning(e=this.table[Oe.Symbol.Columns]){return this.config.returning=Re(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){const{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}prepare(e){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run")}run=e=>this.prepare(!0).run(e);all=e=>this.prepare(!0).all(e);get=e=>this.prepare(!0).get(e);values=e=>this.prepare(!0).values(e);async execute(e){return this.prepare(!0).execute(e)}$dynamic(){return this}}class rt{constructor(e,t,r,n,i,s,a,o){this.mode=e,this.fullSchema=t,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o}static[e]="SQLiteAsyncRelationalQueryBuilder";findMany(e){return"sync"===this.mode?new it(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many"):new nt(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return"sync"===this.mode?new it(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first"):new nt(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}}class nt extends We{constructor(e,t,r,n,i,s,a,o,c){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=r,this.table=n,this.tableConfig=i,this.dialect=s,this.session=a,this.config=o,this.mode=c}static[e]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}prepare(){const{query:e,builtQuery:t}=this._toSQL();return this.session.prepareQuery(t,void 0,"first"===this.mode?"get":"all",((t,r)=>{const n=t.map((t=>ge(this.schema,this.tableConfig,t,e.selection,r)));return"first"===this.mode?n[0]:n}))}_toSQL(){const e=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName});return{query:e,builtQuery:this.dialect.sqlToQuery(e.sql)}}toSQL(){return this._toSQL().builtQuery}executeRaw(){return"first"===this.mode?this.prepare().get():this.prepare().all()}async execute(){return this.executeRaw()}}class it extends nt{static[e]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}}class st extends We{constructor(e,t,r,n,i){super(),this.cb=e,this.getSQLCb=t,this.dialect=n,this.mapBatchResult=i,this.config={action:r}}static[e]="SQLiteRaw";config;getSQL(){return this.getSQLCb()}async execute(){return this.cb()}prepare(){return{getQuery:()=>this.dialect.sqlToQuery(this.getSQL()),mapResult:(e,t)=>t?this.mapBatchResult(e):e}}}class at{constructor(e,t,r,n){if(this.resultKind=e,this.dialect=t,this.session=r,this._=n?{schema:n.schema,tableNamesMap:n.tableNamesMap}:{schema:void 0,tableNamesMap:{}},this.query={},this._.schema)for(const[i,s]of Object.entries(this._.schema))this.query[i]=new rt(e,n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],s,t,r)}static[e]="BaseSQLiteDatabase";query;$with(e){return{as:t=>("function"==typeof t&&(t=t(new Ge)),new Proxy(new _(t.getSQL(),t.getSelectedFields(),e,!0),new _e({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}}with(...e){const t=this;return{select:function(r){return new Ue({fields:r??void 0,session:t.session,dialect:t.dialect,withList:e})},selectDistinct:function(r){return new Ue({fields:r??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}}}select(e){return new Ue({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new Ue({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(e){return new Xe(e,this.session,this.dialect)}insert(e){return new Ze(e,this.session,this.dialect)}delete(e){return new tt(e,this.session,this.dialect)}run(e){const t=e.getSQL();return"async"===this.resultKind?new st((async()=>this.session.run(t)),(()=>t),"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session)):this.session.run(t)}all(e){const t=e.getSQL();return"async"===this.resultKind?new st((async()=>this.session.all(t)),(()=>t),"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session)):this.session.all(t)}get(e){const t=e.getSQL();return"async"===this.resultKind?new st((async()=>this.session.get(t)),(()=>t),"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session)):this.session.get(t)}values(e){const t=e.getSQL();return"async"===this.resultKind?new st((async()=>this.session.values(t)),(()=>t),"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session)):this.session.values(t)}transaction(e,t){return this.session.transaction(e,t)}}class ot extends We{constructor(e){super(),this.resultCb=e}static[e]="ExecuteResultSync";async execute(){return this.resultCb()}sync(){return this.resultCb()}}class ct{constructor(e,t,r){this.mode=e,this.executeMethod=t,this.query=r}static[e]="PreparedQuery";joinsNotNullableMap;getQuery(){return this.query}mapRunResult(e,t){return e}mapAllResult(e,t){throw new Error("Not implemented")}mapGetResult(e,t){throw new Error("Not implemented")}execute(e){return"async"===this.mode?this[this.executeMethod](e):new ot((()=>this[this.executeMethod](e)))}mapResult(e,t){switch(this.executeMethod){case"run":return this.mapRunResult(e,t);case"all":return this.mapAllResult(e,t);case"get":return this.mapGetResult(e,t)}}}class lt{constructor(e){this.dialect=e}static[e]="SQLiteSession";prepareOneTimeQuery(e,t,r){return this.prepareQuery(e,t,r)}run(e){const t=this.dialect.sqlToQuery(e);try{return this.prepareOneTimeQuery(t,void 0,"run").run()}catch(e){throw new Ce({cause:e,message:`Failed to run the query '${t.sql}'`})}}extractRawRunValueFromBatchResult(e){return e}all(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run").all()}extractRawAllValueFromBatchResult(e){throw new Error("Not implemented")}get(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run").get()}extractRawGetValueFromBatchResult(e){throw new Error("Not implemented")}values(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run").values()}extractRawValuesValueFromBatchResult(e){throw new Error("Not implemented")}}class ut extends at{constructor(e,t,r,n,i=0){super(e,t,r,n),this.schema=n,this.nestedIndex=i}static[e]="SQLiteTransaction";rollback(){throw new Pe}}class dt extends lt{constructor(e,t,r,n={}){super(t),this.client=e,this.schema=r,this.options=n,this.logger=n.logger??new a}static[e]="SQLiteD1Session";logger;prepareQuery(e,t,r,n){const i=this.client.prepare(e.sql);return new ft(i,e,this.logger,t,r,n)}async batch(e){const t=[],r=[];for(const n of e){const e=n.prepare(),i=e.getQuery();if(t.push(e),i.params.length>0)r.push(e.stmt.bind(...i.params));else{const t=e.getQuery();r.push(this.client.prepare(t.sql).bind(...t.params))}}return(await this.client.batch(r)).map(((e,r)=>t[r].mapResult(e,!0)))}extractRawAllValueFromBatchResult(e){return e.results}extractRawGetValueFromBatchResult(e){return e.results[0]}extractRawValuesValueFromBatchResult(e){return pt(e.results)}async transaction(e,t){const r=new ht("async",this.dialect,this,this.schema);await this.run(j.raw("begin"+(t?.behavior?" "+t.behavior:"")));try{const t=await e(r);return await this.run(j`commit`),t}catch(e){throw await this.run(j`rollback`),e}}}class ht extends ut{static[e]="D1Transaction";async transaction(e){const t=`sp${this.nestedIndex}`,r=new ht("async",this.dialect,this.session,this.schema,this.nestedIndex+1);await this.session.run(j.raw(`savepoint ${t}`));try{const n=await e(r);return await this.session.run(j.raw(`release savepoint ${t}`)),n}catch(e){throw await this.session.run(j.raw(`rollback to savepoint ${t}`)),e}}}function pt(e){const t=[];for(const r of e){const e=Object.keys(r).map((e=>r[e]));t.push(e)}return t}class ft extends ct{constructor(e,t,r,n,i,s){super("async",i,t),this.logger=r,this.customResultMapper=s,this.fields=n,this.stmt=e}static[e]="D1PreparedQuery";customResultMapper;fields;stmt;run(e){const t=D(this.query.params,e??{});return this.logger.logQuery(this.query.sql,t),this.stmt.bind(...t).run()}async all(e){const{fields:t,query:r,logger:n,stmt:i,customResultMapper:s}=this;if(!t&&!s){const t=D(r.params,e??{});return n.logQuery(r.sql,t),i.bind(...t).all().then((({results:e})=>this.mapAllResult(e)))}const a=await this.values(e);return this.mapAllResult(a)}mapAllResult(e,t){return t&&(e=pt(e.results)),this.fields||this.customResultMapper?this.customResultMapper?this.customResultMapper(e):e.map((e=>ke(this.fields,e,this.joinsNotNullableMap))):e}async get(e){const{fields:t,joinsNotNullableMap:r,query:n,logger:i,stmt:s,customResultMapper:a}=this;if(!t&&!a){const t=D(n.params,e??{});return i.logQuery(n.sql,t),s.bind(...t).all().then((({results:e})=>e[0]))}const o=await this.values(e);if(o[0])return a?a(o):ke(t,o[0],r)}mapGetResult(e,t){return t&&(e=pt(e.results)[0]),this.fields||this.customResultMapper?this.customResultMapper?this.customResultMapper([e]):ke(this.fields,e,this.joinsNotNullableMap):e}values(e){const t=D(this.query.params,e??{});return this.logger.logQuery(this.query.sql,t),this.stmt.bind(...t).raw()}}class yt extends at{static[e]="LibSQLDatabase";async batch(e){return this.session.batch(e)}}function mt(e,r={}){const n=new Ie;let i,a;if(!0===r.logger?i=new s:!1!==r.logger&&(i=r.logger),r.schema){const e=function(e,r){1===Object.keys(e).length&&"default"in e&&!t(e.default,y)&&(e=e.default);const n={},i={},s={};for(const[o,c]of Object.entries(e))if("object"==typeof(a=c)&&null!==a&&f in a){const e=c[y.Symbol.Name],r=i[e];n[e]=o,s[o]={tsName:o,dbName:c[y.Symbol.Name],schema:c[y.Symbol.Schema],columns:c[y.Symbol.Columns],relations:r?.relations??{},primaryKey:r?.primaryKey??[]};for(const e of Object.values(c[y.Symbol.Columns]))e.primary&&s[o].primaryKey.push(e);const a=c[y.Symbol.ExtraConfigBuilder]?.(c);if(a)for(const e of Object.values(a))t(e,S)&&s[o].primaryKey.push(...e.columns)}else if(t(c,ue)){const e=c.table[y.Symbol.Name],t=n[e],a=c.config(r(c.table));let o;for(const[r,n]of Object.entries(a))if(t){const e=s[t];e.relations[r]=n,o&&e.primaryKey.push(...o)}else e in i||(i[e]={relations:{},primaryKey:o}),i[e].relations[r]=n}var a;return{tables:s,tableNamesMap:n}}(r.schema,me);a={fullSchema:r.schema,schema:e.tables,tableNamesMap:e.tableNamesMap}}const o=new dt(e,n,a,{logger:i});return new yt("async",n,o,a)}var gt=r(208);async function wt(e,t,r){var n={};const i="gcploggingproject-427121",s="my-log",a="ERROR";if(gt.default.logEntry(i,e.GCP_LOGGING_CREDENTIALS,s,a,"got here"),r){var o=await fetch(e.USER_PROFILE_SVC_URL,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+r}}),c=JSON.parse(await o.text());gt.default.logEntry(i,e.GCP_LOGGING_CREDENTIALS,s,a,"got here 3"),n.groups=c.groups}const l=mt(e.user_prefs_database);if(0==(u=await e.user_prefs_database.prepare("select * from user_preferences where account_id = ?").bind(t).all()).results.length){await l.insert(user_preferences).values({account_id:t,preferences:{},last_update_datetime:new Date}).run();var u=await e.user_prefs_database.prepare("select * from user_preferences where account_id = ?").bind(t).all();return n.preferences=u.results[0],n.account_id=u.results[0].account_id,n}return n.preferences=u.results[0],n.account_id=u.results[0].account_id,n}class bt{static[e]="ColumnBuilder";config;constructor(e,t,r){this.config={name:e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:r}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}}class St{static[e]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{const{name:t,columns:r,foreignColumns:n}=e();return{name:t,columns:r,foreignTable:n[0].table,foreignColumns:n}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=void 0===e?"no action":e,this}onDelete(e){return this._onDelete=void 0===e?"no action":e,this}build(e){return new Et(e,this)}}class Et{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[e]="PgForeignKey";reference;onUpdate;onDelete;getName(){const{name:e,columns:t,foreignColumns:r}=this.reference(),n=t.map((e=>e.name)),i=r.map((e=>e.name)),s=[this.table[b.Symbol.Name],...n,r[0].table[b.Symbol.Name],...i];return e??`${s.join("_")}_fk`}}function vt(e,t,r){for(let n=t;n<e.length;n++){const i=e[n];if("\\"!==i){if('"'===i)return[e.slice(t,n).replace(/\\/g,""),n+1];if(!r&&(","===i||"}"===i))return[e.slice(t,n).replace(/\\/g,""),n]}else n++}return[e.slice(t).replace(/\\/g,""),e.length]}function At(e,t=0){const r=[];let n=t,i=!1;for(;n<e.length;){const s=e[n];if(","===s){(i||n===t)&&r.push(""),i=!0,n++;continue}if(i=!1,"\\"===s){n+=2;continue}if('"'===s){const[t,i]=vt(e,n+1,!0);r.push(t),n=i;continue}if("}"===s)return[r,n+1];if("{"===s){const[t,i]=At(e,n+1);r.push(t),n=i;continue}const[a,o]=vt(e,n,!1);r.push(a),n=o}return[r,n]}function _t(e){const[t]=At(e,1);return t}function Ct(e){return`{${e.map((e=>Array.isArray(e)?Ct(e):"string"==typeof e?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`)).join(",")}}`}class Pt extends bt{foreignKeyConfigs=[];static[e]="PgColumnBuilder";array(e){return new Ot(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map((({ref:r,actions:n})=>function(e,...t){return e(...t)}(((r,n)=>{const i=new St((()=>{const t=r();return{columns:[e],foreignColumns:[t]}}));return n.onUpdate&&i.onUpdate(n.onUpdate),n.onDelete&&i.onDelete(n.onDelete),i.build(t)}),r,n)))}}class Tt extends g{constructor(e,t){t.uniqueName||(t.uniqueName=function(e,t){return`${e[b.Symbol.Name]}_${t.join("_")}_unique`}(e,[t.name])),super(e,t),this.table=e}static[e]="PgColumn"}class Ot extends Pt{static[e]="PgArrayBuilder";constructor(e,t,r){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=r}build(e){const t=this.config.baseBuilder.build(e);return new xt(e,this.config,t)}}class xt extends Tt{constructor(e,t,r,n){super(e,t),this.baseColumn=r,this.range=n,this.size=t.size}size;static[e]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(e){return"string"==typeof e&&(e=_t(e)),e.map((e=>this.baseColumn.mapFromDriverValue(e)))}mapToDriverValue(e,r=!1){const n=e.map((e=>null===e?null:t(this.baseColumn,xt)?this.baseColumn.mapToDriverValue(e,!0):this.baseColumn.mapToDriverValue(e)));return r?n:Ct(n)}}class kt extends Pt{static[e]="PgVarcharBuilder";constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new Rt(e,this.config)}}class Rt extends Tt{static[e]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}class Nt extends Tt{static[e]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{return e}return e}}class Ht extends Pt{static[e]="PgDateColumnBaseBuilder";defaultNow(){return this.default(j`now()`)}}class jt extends Ht{static[e]="PgTimestampBuilder";constructor(e,t,r){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=r}build(e){return new Kt(e,this.config)}}class Kt extends Tt{static[e]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${void 0===this.precision?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>this.withTimezone?e.toUTCString():e.toISOString()}class $t extends Ht{static[e]="PgTimestampStringBuilder";constructor(e,t,r){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=r}build(e){return new Dt(e,this.config)}}class Dt extends Tt{static[e]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){return`timestamp${void 0===this.precision?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}const It=function(e,t,r,n,i=e){const s=new Oe(e,n,i),a=Object.fromEntries(Object.entries(t).map((([e,t])=>{const r=t,n=r.build(s);return s[Te].push(...r.buildForeignKeys(n,s)),[e,n]}))),o=Object.assign(s,a);return o[y.Symbol.Columns]=a,r&&(o[Oe.Symbol.ExtraConfigBuilder]=r),o}("user_preferences",{account_id:function(e,t={}){return new kt("account_id",t)}().notNull().primaryKey(),preferences:("preferences",new class extends Pt{static[e]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new Nt(e,this.config)}}("preferences")).notNull(),last_update_datetime:function(e,t={}){return"string"===t.mode?new $t(e,t.withTimezone??!1,t.precision):new jt(e,t.withTimezone??!1,t.precision)}("last_update_datetime").notNull()},void 0);const Jt=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map((e=>[e.name,e])),Wt=new Map(Jt);Error;const Ut=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],Lt=new WeakSet,Bt=({from:e,seen:t,to:r,forceEnumerable:n,maxDepth:i,depth:s,useToJSON:a,serialize:o})=>{if(r||(r=Array.isArray(e)?[]:!o&&Mt(e)?new((e=>Wt.get(e)??Error)(e.name)):{}),t.push(e),s>=i)return r;if(a&&"function"==typeof e.toJSON&&!Lt.has(e))return(e=>{Lt.add(e);const t=e.toJSON();return Lt.delete(e),t})(e);const c=e=>Bt({from:e,seen:[...t],forceEnumerable:n,maxDepth:i,depth:s,useToJSON:a,serialize:o});for(const[n,i]of Object.entries(e))if(i&&i instanceof Uint8Array&&"Buffer"===i.constructor.name)r[n]="[object Buffer]";else if(null===i||"object"!=typeof i||"function"!=typeof i.pipe){if("function"!=typeof i)if(i&&"object"==typeof i)t.includes(e[n])?r[n]="[Circular]":(s++,r[n]=c(e[n]));else try{r[n]=i}catch{}}else r[n]="[object Stream]";for(const{property:t,enumerable:i}of Ut)void 0!==e[t]&&null!==e[t]&&Object.defineProperty(r,t,{value:Mt(e[t])?c(e[t]):e[t],enumerable:!!n||i,configurable:!0,writable:!0});return r};function Mt(e){return Boolean(e)&&"object"==typeof e&&"name"in e&&"message"in e&&"stack"in e}const qt={async fetch(e,t,r){try{const r="gcploggingproject-427121",n="my-log",i="ERROR",s="This is a log message.";return gt.default.logEntry(r,t.GCP_LOGGING_CREDENTIALS,n,i,s),await async function(e,t,r){var n=e.headers.get("Origin")||e.headers.get("origin");if("OPTIONS"===e.method){const r=await t.CORS_DOMAINS.split(",");var i=!1;for(var s in r)new RegExp(r[s]).test(n)&&(i=!0);return i?new Response("",{status:204,headers:{"Access-Control-Allow-Credentials":"true","Access-Control-Allow-Origin":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, DELETE, PUT","Access-Control-Allow-Headers":"Authorization, Content-Type, Identity",Connection:e.headers.get("Connection")}}):new Response(JSON.stringify({message:"CORS Not supported -> "+n}),{status:403,headers:{"Content-Type":"application/json"}})}if("GET"===new String(e.method).valueOf().toUpperCase()&&new String(e.url.substring(e.url.lastIndexOf("/")+1)).valueOf()===new String(t.INITIALIZATION_KEY).valueOf())return await async function(e){console.log("Initializing database");const t=mt(e.user_prefs_database);try{await t.select().from(It).where(W(It.account_id,0))}catch(t){await e.user_prefs_database.prepare("CREATE TABLE user_preferences (\n        account_id varchar(64) PRIMARY KEY,\n        preferences jsonb,\n        last_update_datetime timestamp)").run()}return"initialization complete"}(t),new Response("",{status:200,headers:{"Content-Type":"application/json"}});var a="";if(null==e.headers.get("Authorization")&&null==e.headers.get("authorization"))return new Response(JSON.stringify({message:"Authorization header not found."}),{status:403,headers:{"Content-Type":"application/json"}});null!=e.headers.get("Authorization")&&e.headers.get("Authorization").startsWith("Bearer ")?a=e.headers.get("Authorization").split(" ")[1]:null!=e.headers.get("authorization")&&e.headers.get("authorization").startsWith("Bearer ")&&(a=e.headers.get("authorization").split(" ")[1]);var o={"Access-Control-Allow-Credentials":"true","Access-Control-Allow-Origin":n,"Access-Control-Allow-Methods":"POST, GET, OPTIONS, DELETE, PUT","Access-Control-Allow-Headers":"Authorization, Content-Type, Identity",Connection:e.headers.get("Connection"),"Content-Type":"application/json"};const c="https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token="+a;var l=await fetch(c,{method:"GET",headers:{"Content-Type":"application/json"}}),u=JSON.parse(await l.text());if(null==u||null==u.id)return new Response(JSON.stringify({message:"Account not found / token invalid."}),{status:403,headers:{"Content-Type":"application/json"}});gt.default.logEntry("gcploggingproject-427121",t.GCP_LOGGING_CREDENTIALS,"my-log","ERROR","got here first");var d={};switch(e.method){case"GET":d=await wt(t,u.id,e.headers.get("Identity"));break;case"PUT":var h=await e.json();d=await async function(e,t,r){var n=await wt(e,t);if("account_id"in n){const a=mt(e.user_prefs_database);var i=JSON.parse(n.preferences.preferences);for(var s of Object.keys(r))i[s]=r[s];return await a.update(user_preferences).set({preferences:i,last_update_datetime:new Date}).where(W(user_preferences.account_id,t)).run(),wt(e,t)}return{}}(t,u.id,h,e.headers.get("Identity"));break;case"POST":h=await e.json(),d=await async function(e,t){return{}}(0,u.id,e.headers.get("Identity"));break;case"DELETE":d=await async function(e,t){return{}}(0,u.id,e.headers.get("Identity"))}return new Response(JSON.stringify(d),{status:200,headers:o})}(e,t)}catch(e){const t=function(e,t={}){const{maxDepth:r=Number.POSITIVE_INFINITY,useToJSON:n=!0}=t;return"object"==typeof e&&null!==e?Bt({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0,useToJSON:n,serialize:!0}):"function"==typeof e?`[Function: ${e.name||"anonymous"}]`:e}(e);return new Response(JSON.stringify(t),{status:500,headers:{"Content-Type":"application/json"}})}}}})();var i=n.c;export{i as default};